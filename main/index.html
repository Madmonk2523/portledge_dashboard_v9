<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,viewport-fit=cover,user-scalable=yes"/>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Portledge Dashboard — v11 (Role-Based)</title>
<link rel="icon" href="data:," />

<!-- PWA & Mobile Optimizations -->
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Portledge"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no"/>
<!-- PWA removed per request: manifest & apple icon links deleted -->

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
<meta name="theme-color" content="#003366" media="(prefers-color-scheme: light)"/>
<meta name="theme-color" content="#0a0e1a" media="(prefers-color-scheme: dark)"/>


<style>

.clock-wrap {
  font-size: 1.1rem;
  font-weight: 800;
  color: #4A90E2; /* Blue clock */
  display: flex;
  justify-content: center;
  margin-bottom: 6px;
}

/* Compact Status + Progress Bar - Horizontal Layout - Enhanced */
.status-bar {
  margin: 16px auto 24px;
  max-width: 750px;
  font-weight: 700;
  color: #0f172a;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 16px;
  padding: 16px 24px;
  background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
  border-radius: 20px;
  border: 2px solid #e2e8f0;
  box-shadow: 0 4px 16px rgba(0,0,0,0.06);
}

#s_currentLabel {
  white-space: nowrap;
  font-size: 0.95rem;
  font-weight: 700;
  color: #334155;
  letter-spacing: -0.01em;
}

.status-progress {
  flex: 1;
  height: 12px;
  background: #e2e8f0;
  border-radius: 999px;
  overflow: hidden;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.08);
}

#s_progressFill {
  height: 100%;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);
  transition: width .5s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
}


.p-done {
  background:linear-gradient(90deg,#4A90E2,#6AB0FF) !important; /* Blue progress fill */
}

:root{
  --navy:#003366; --navy-2:#0b3f7a; --blue:#2b6ccf;
  --ink:#162133; --muted:#6c768b; --rail:#e0e6f0; --panel:#fff; --bg:#f3f6fb;
  --good:#1fa86a; --info:#4f87c7; --done:#9aa6bf;
  --radius:14px; --shadow:0 10px 28px rgba(10,20,40,.08); --ease:cubic-bezier(.4,0,.2,1);
}

/* ===== Visual Polish Enhancements ===== */
@keyframes fadeIn{0%{opacity:0; transform:translateY(10px)}100%{opacity:1; transform:translateY(0)}}
@keyframes slideInRight{0%{opacity:0; transform:translateX(30px)}100%{opacity:1; transform:translateX(0)}}
@keyframes scaleIn{0%{opacity:0; transform:scale(0.95)}100%{opacity:1; transform:scale(1)}}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
@keyframes ripple{0%{transform:scale(0); opacity:1}100%{transform:scale(4); opacity:0}}

/* Smooth page transitions */
.page{animation:fadeIn 0.4s var(--ease)}
.tab{animation:scaleIn 0.3s var(--ease); animation-fill-mode:backwards}
.tab:nth-child(1){animation-delay:0.05s}
.tab:nth-child(2){animation-delay:0.1s}
.tab:nth-child(3){animation-delay:0.15s}
.tab:nth-child(4){animation-delay:0.2s}
.tab:nth-child(5){animation-delay:0.25s}

/* Enhanced button interactions */
.btn:active, .daybtn:active{transform:translateY(0) scale(0.98) !important}
.tab:active{transform:scale(0.95)}

/* Subtle gradient animation on login screen */
#login{animation:shimmer 20s linear infinite; background-size:200% 100%}

/* Card hover glow */
.slot:hover::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:24px;
  background:linear-gradient(135deg, rgba(59,130,246,0.1), rgba(147,197,253,0.05));
  pointer-events:none;
  opacity:0;
  animation:fadeIn 0.3s forwards;
}

/* Smooth theme transition */
body{transition:background 0.6s var(--ease), color 0.6s var(--ease)}

*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;
  font:15.5px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
  color:var(--ink);
  background:var(--bg);
  -webkit-font-smoothing:antialiased;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  scroll-behavior:smooth;
  /* iPhone safe area support */
  padding-top:env(safe-area-inset-top);
  padding-bottom:env(safe-area-inset-bottom);
  padding-left:env(safe-area-inset-left);
  padding-right:env(safe-area-inset-right);
}
html{scroll-behavior:smooth}
:focus-visible{outline:3px solid #94b0ff; outline-offset:3px; border-radius:8px}
@media(prefers-reduced-motion:reduce){*{animation-duration:.001ms!important;animation-iteration-count:1!important;transition-duration:.001ms!important;scroll-behavior:auto!important}}

/* Performance optimizations */
.page,.timeline,.slot,.tab,.panel{will-change:auto;contain:layout style}
.now-indicator,.p-done{will-change:transform,top,width}

/* ===== Dark mode (toggle) ===== */
body.theme-dark{
  --bg:#0a0e1a;
  --ink:#e8f0ff;
  --panel:#0f1729;
  --rail:#1e2942;
  --navy:#667eea; --navy-2:#764ba2;
  --muted:#b4c0e0;
  --blue:#6b9eff;
  --done:#7a8aa8; --info:#5eb3ff; --good:#4ade80;
  color-scheme: dark;
  background:linear-gradient(135deg, #0a0e1a 0%, #1a1f35 50%, #0f1729 100%);
  background-attachment:fixed;
  transition:all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* Smooth transitions on theme change */
body, .nav, .tab, .panel, .card, .chip, .badge, .slot, .input, select, .login-card {
  transition: background 0.4s ease, color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
}

/* Ultra-premium glass morphism components */
body.theme-dark .nav{
  background:rgba(15, 23, 41, 0.85); 
  backdrop-filter:blur(20px) saturate(180%);
  border-bottom:1px solid rgba(102, 126, 234, 0.2);
  box-shadow:0 8px 32px rgba(0,0,0,0.4);
}
body.theme-dark .tab{
  background:rgba(15, 23, 41, 0.6); 
  backdrop-filter:blur(10px);
  color:var(--ink); 
  border:1px solid rgba(102, 126, 234, 0.15);
}
body.theme-dark .tab:hover{
  background:rgba(102, 126, 234, 0.2);
  border-color:rgba(102, 126, 234, 0.4);
  box-shadow:0 0 20px rgba(102, 126, 234, 0.3);
  transform:translateY(-2px);
}
body.theme-dark .tab.active{
  background:linear-gradient(135deg, rgba(102, 126, 234, 0.25), rgba(118, 75, 162, 0.25));
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 0 30px rgba(102, 126, 234, 0.4), inset 0 0 20px rgba(102, 126, 234, 0.1);
}
body.theme-dark .panel{
  background:rgba(15, 23, 41, 0.7); 
  backdrop-filter:blur(20px) saturate(180%);
  border:1px solid rgba(102, 126, 234, 0.2); 
  box-shadow:0 20px 60px rgba(0,0,0,.5), 0 0 40px rgba(102, 126, 234, 0.1);
}
body.theme-dark .legend .lg{color:var(--muted)}
body.theme-dark .rail{
  background:linear-gradient(180deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
  box-shadow:0 0 24px rgba(102, 126, 234, 0.2);
}
body.theme-dark .timeline .slot{
  background:rgba(15, 23, 41, 0.85);
  backdrop-filter:blur(20px);
  border:2px solid rgba(102, 126, 234, 0.25);
  box-shadow:0 10px 30px rgba(0,0,0,.6), 0 0 24px rgba(102, 126, 234, 0.15);
}
body.theme-dark .timeline .slot:hover{
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 16px 40px rgba(0,0,0,.7), 0 0 36px rgba(102, 126, 234, 0.25);
  transform:translateY(-4px) scale(1.01);
}
body.theme-dark .status-bar{
  color:#e2e8f0;
  background:rgba(15, 23, 41, 0.9);
  border:2px solid rgba(102, 126, 234, 0.3);
  box-shadow:0 6px 20px rgba(0,0,0,.5), 0 0 24px rgba(102, 126, 234, 0.15);
}
body.theme-dark #s_currentLabel{
  color:#cbd5e1;
}
body.theme-dark .status-progress{
  background:rgba(26, 40, 70, 0.7);
  box-shadow:inset 0 2px 6px rgba(0,0,0,0.6);
}
body.theme-dark #s_progressFill{
  background:linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  box-shadow:0 0 24px rgba(102, 126, 234, 0.7);
  animation:pulseGlow 3s ease-in-out infinite;
}
@keyframes pulseGlow{
  0%, 100%{box-shadow:0 0 20px rgba(102, 126, 234, 0.6)}
  50%{box-shadow:0 0 40px rgba(102, 126, 234, 0.9), 0 0 60px rgba(118, 75, 162, 0.5)}
}
body.theme-dark .bigdate{
  color:#e2e8f0;
  text-shadow:0 3px 12px rgba(102, 126, 234, 0.4);
}
body.theme-dark .daybtn{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:linear-gradient(135deg, rgba(15, 23, 41, 0.9) 0%, rgba(30, 41, 66, 0.9) 100%);
  color:#e2e8f0;
  box-shadow:0 4px 12px rgba(0,0,0,0.5), 0 0 16px rgba(102, 126, 234, 0.1);
}
body.theme-dark .daybtn:hover{
  background:linear-gradient(135deg, rgba(30, 41, 66, 0.95) 0%, rgba(45, 55, 85, 0.95) 100%);
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 6px 16px rgba(0,0,0,0.6), 0 0 24px rgba(102, 126, 234, 0.2);
}
body.theme-dark .badge.now{
  background:rgba(16, 54, 39, 0.8); 
  color:#4ade80; 
  border:1px solid rgba(74, 222, 128, 0.4);
  box-shadow:0 0 20px rgba(74, 222, 128, 0.3);
}
body.theme-dark .badge.up{
  background:rgba(16, 34, 66, 0.8); 
  color:#5eb3ff; 
  border:1px solid rgba(94, 179, 255, 0.4);
  box-shadow:0 0 20px rgba(94, 179, 255, 0.3);
}
body.theme-dark .badge.done{
  background:rgba(15, 21, 36, 0.8); 
  color:#b4c0e0; 
  border:1px solid rgba(45, 57, 88, 0.6);
}
body.theme-dark .chip{
  background:rgba(15, 23, 41, 0.8); 
  backdrop-filter:blur(10px);
  color:var(--ink); 
  border:1px solid rgba(102, 126, 234, 0.25); 
  box-shadow:0 8px 20px rgba(0,0,0,.4), 0 0 15px rgba(102, 126, 234, 0.1);
}
body.theme-dark .input, body.theme-dark select{
  background:rgba(12, 22, 48, 0.8); 
  backdrop-filter:blur(10px);
  color:var(--ink); 
  border:1px solid rgba(102, 126, 234, 0.2);
  box-shadow:inset 0 2px 8px rgba(0,0,0,0.5);
}
body.theme-dark .input:focus, body.theme-dark select:focus{
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 0 30px rgba(102, 126, 234, 0.4), inset 0 2px 8px rgba(0,0,0,0.5);
}
body.theme-dark .card, body.theme-dark .gcard, body.theme-dark .gpa, body.theme-dark .person{
  background:rgba(15, 23, 41, 0.8); 
  backdrop-filter:blur(15px);
  border:1px solid rgba(102, 126, 234, 0.2); 
  box-shadow:0 15px 40px rgba(0,0,0,.5), 0 0 30px rgba(102, 126, 234, 0.1);
}
/* Grades page text tweaks */
body.theme-dark .gsub{color:#9fb0d6}
body.theme-dark .gpa-meta{color:#9fb0d6}
body.theme-dark .gtitle{color:var(--ink)}
body.theme-dark .ggrade{color:#8bb3ff}
body.theme-dark .card:hover, body.theme-dark .gcard:hover{
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 16px 40px rgba(0,0,0,.7), 0 0 36px rgba(102, 126, 234, 0.25);
  transform:translateY(-4px) scale(1.01);
}
body.theme-dark .card{
  border:2px solid rgba(102, 126, 234, 0.25);
  background:rgba(15, 23, 41, 0.85);
  box-shadow:0 6px 16px rgba(0,0,0,0.5), 0 0 20px rgba(102, 126, 234, 0.1);
}
body.theme-dark .gcard{
  border:2px solid rgba(102, 126, 234, 0.25);
  background:rgba(15, 23, 41, 0.85);
  box-shadow:0 8px 20px rgba(0,0,0,0.5), 0 0 24px rgba(102, 126, 234, 0.1);
}
body.theme-dark .person{
  border:2px solid rgba(102, 126, 234, 0.25);
  background:rgba(15, 23, 41, 0.85);
  box-shadow:0 6px 16px rgba(0,0,0,0.5), 0 0 20px rgba(102, 126, 234, 0.1);
}
body.theme-dark .person:hover{
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 12px 28px rgba(0,0,0,.6), 0 0 32px rgba(102, 126, 234, 0.2);
}
body.theme-dark .card .h{color:#e2e8f0}
body.theme-dark .person .name{color:#e2e8f0}
body.theme-dark .timeline .slot{
  background:rgba(15, 23, 41, 0.85);
  backdrop-filter:blur(20px);
  border:2px solid rgba(102, 126, 234, 0.25);
  box-shadow:0 10px 30px rgba(0,0,0,.6), 0 0 24px rgba(102, 126, 234, 0.15);
}
body.theme-dark .timeline .slot:hover{
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 16px 40px rgba(0,0,0,.7), 0 0 36px rgba(102, 126, 234, 0.25);
  transform:translateY(-4px) scale(1.01);
}
body.theme-dark .cls{color:#e2e8f0; font-weight:900}
body.theme-dark .time{color:#cbd5e1; font-weight:800}
body.theme-dark .meta{color:#94a3b8; font-weight:500}
/* Dark mode mini progress styling */
body.theme-dark .gpa-badge{
  background:linear-gradient(135deg, rgba(30, 58, 138, 0.9) 0%, rgba(23, 37, 84, 0.9) 100%);
  color:#bfdbfe;
  border:2px solid rgba(147, 197, 253, 0.4);
  box-shadow:0 4px 16px rgba(59, 130, 246, 0.3);
}
body.theme-dark .gpa{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:linear-gradient(135deg, rgba(15, 23, 41, 0.9) 0%, rgba(20, 28, 50, 0.9) 100%);
  box-shadow:0 8px 24px rgba(0,0,0,.5), 0 0 24px rgba(102, 126, 234, 0.15);
}
body.theme-dark .gpa:hover{
  box-shadow:0 12px 32px rgba(0,0,0,.6), 0 0 32px rgba(102, 126, 234, 0.2);
  border-color:rgba(102, 126, 234, 0.5);
}
body.theme-dark .login-card{
  background:rgba(15, 23, 41, 0.95); 
  backdrop-filter:blur(30px) saturate(180%);
  box-shadow:0 40px 100px rgba(0,0,0,.7), 0 0 60px rgba(102, 126, 234, 0.3);
  border:1px solid rgba(102, 126, 234, 0.3);
}
body.theme-dark ::selection{
  background:rgba(102, 126, 234, 0.4); 
  color:#fff;
}
body.theme-dark ::-webkit-scrollbar{width:12px; height:12px}
body.theme-dark ::-webkit-scrollbar-track{
  background:rgba(12, 22, 48, 0.5);
}
body.theme-dark ::-webkit-scrollbar-thumb{
  background:linear-gradient(135deg, #667eea, #764ba2); 
  border-radius:999px;
  border:2px solid rgba(12, 22, 48, 0.5);
  box-shadow:0 0 10px rgba(102, 126, 234, 0.5);
}

/* Global text visibility improvements in dark mode */
body.theme-dark h1,
body.theme-dark h2,
body.theme-dark h3,
body.theme-dark h4,
body.theme-dark h5,
body.theme-dark h6,
body.theme-dark p,
body.theme-dark label,
body.theme-dark span,
body.theme-dark li,
body.theme-dark th,
body.theme-dark td {
  color: var(--ink);
}
/* Buttons and nav controls - Enhanced Dark Mode */
body.theme-dark .btn{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:linear-gradient(135deg, rgba(15, 23, 41, 0.9) 0%, rgba(30, 41, 66, 0.9) 100%);
  color:#e2e8f0;
  box-shadow:0 4px 12px rgba(0,0,0,0.5), 0 0 16px rgba(102, 126, 234, 0.1);
}
body.theme-dark .btn:hover{
  background:linear-gradient(135deg, rgba(30, 41, 66, 0.95) 0%, rgba(45, 55, 85, 0.95) 100%);
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 6px 16px rgba(0,0,0,0.6), 0 0 24px rgba(102, 126, 234, 0.2);
}
body.theme-dark .btn.primary{
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color:transparent;
  box-shadow:0 6px 16px rgba(102, 126, 234, 0.5), 0 0 24px rgba(102, 126, 234, 0.3);
}
body.theme-dark .btn.primary:hover{
  background:linear-gradient(135deg, #764ba2 0%, #893fc2 100%);
  box-shadow:0 8px 20px rgba(102, 126, 234, 0.6), 0 0 32px rgba(118, 75, 162, 0.4);
}
body.theme-dark .input, body.theme-dark select{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:rgba(15, 23, 41, 0.9);
  color:#e2e8f0;
  box-shadow:0 2px 8px rgba(0,0,0,0.5);
}
body.theme-dark .input:focus, body.theme-dark select:focus{
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 0 0 3px rgba(102, 126, 234, 0.2), 0 4px 16px rgba(0,0,0,0.6);
}
body.theme-dark .gbtn{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:linear-gradient(135deg, rgba(15, 23, 41, 0.9) 0%, rgba(30, 41, 66, 0.9) 100%);
  color:#e2e8f0;
  box-shadow:0 4px 12px rgba(0,0,0,0.5);
}
body.theme-dark .gbtn:hover{
  background:linear-gradient(135deg, rgba(30, 41, 66, 0.95) 0%, rgba(45, 55, 85, 0.95) 100%);
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 6px 16px rgba(0,0,0,0.6), 0 0 20px rgba(102, 126, 234, 0.2);
}
body.theme-dark .daybtn{
  border:2px solid rgba(102, 126, 234, 0.3);
  background:linear-gradient(135deg, rgba(15, 23, 41, 0.9) 0%, rgba(30, 41, 66, 0.9) 100%);
  color:#e2e8f0;
  box-shadow:0 4px 12px rgba(0,0,0,0.5), 0 0 16px rgba(102, 126, 234, 0.1);
}
body.theme-dark .daybtn:hover{
  background:linear-gradient(135deg, rgba(30, 41, 66, 0.95) 0%, rgba(45, 55, 85, 0.95) 100%);
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 6px 16px rgba(0,0,0,0.6), 0 0 24px rgba(102, 126, 234, 0.2);
}
/* Keep primary buttons bright */
body.theme-dark .btn.primary{
  color:#fff;
}
body.theme-dark ::-webkit-scrollbar-thumb:hover{
  background:linear-gradient(135deg, #764ba2, #667eea);
  box-shadow:0 0 20px rgba(102, 126, 234, 0.8);
}

/* PantherBot dark mode enhancements */
body.theme-dark #pantherbot-container{
  background:rgba(15, 23, 41, 0.9);
  backdrop-filter:blur(20px);
  border-color:rgba(102, 126, 234, 0.3);
  box-shadow:0 20px 60px rgba(0,0,0,.6), 0 0 40px rgba(102, 126, 234, 0.15);
}
body.theme-dark .chat-container{
  background:rgba(15, 23, 41, 0.85);
  border:1px solid rgba(102, 126, 234, 0.3);
  box-shadow:0 8px 32px rgba(0,0,0,0.5), 0 0 30px rgba(102, 126, 234, 0.15);
}
body.theme-dark .chat-messages{
  background:rgba(10, 15, 30, 0.6);
}
body.theme-dark .chat-message.bot{
  background:rgba(102, 126, 234, 0.15);
  border-left:3px solid #667eea;
  box-shadow:0 0 15px rgba(102, 126, 234, 0.2);
  color:#e8f0ff;
  border-color:rgba(102, 126, 234, 0.3);
}
body.theme-dark .chat-message.user{
  background:rgba(118, 75, 162, 0.15);
  border-left:3px solid #764ba2;
  color:#f0e8ff;
}
body.theme-dark .chat-message.bot.typing{
  color:#c7d7ff;
}
body.theme-dark .chat-input{
  background:rgba(15, 23, 41, 0.95);
  border-top:1px solid rgba(102, 126, 234, 0.25);
}
body.theme-dark .chat-input input{
  background:rgba(10, 15, 30, 0.8);
  border-color:rgba(102, 126, 234, 0.3);
  color:#e8f0ff;
}
body.theme-dark .chat-input input:focus{
  border-color:#667eea;
  background:rgba(10, 15, 30, 0.95);
  box-shadow:0 0 0 4px rgba(102, 126, 234, 0.2);
}
body.theme-dark .chat-input input::placeholder{
  color:rgba(180, 192, 224, 0.6);
}
body.theme-dark .pb-suggestions .chip{
  background:rgba(102, 126, 234, 0.15);
  border:1px solid rgba(102, 126, 234, 0.3);
  color:#c7d7ff;
}
body.theme-dark .pb-suggestions .chip:hover{
  background:rgba(102, 126, 234, 0.25);
  border-color:rgba(102, 126, 234, 0.5);
  color:#e8f0ff;
}
body.theme-dark .citations{
  background:rgba(102, 126, 234, 0.1);
  border:1px solid rgba(102, 126, 234, 0.2);
}
body.theme-dark .cite-label{
  color:#c7d7ff;
}
body.theme-dark .cite-link{
  color:#8bb3ff;
}
body.theme-dark .related-questions{
  background:rgba(102, 126, 234, 0.08);
  border:1px solid rgba(102, 126, 234, 0.2);
}
body.theme-dark .rq-label{
  color:#c7d7ff;
}
body.theme-dark .rq-btn{
  background:rgba(102, 126, 234, 0.15);
  border:1px solid rgba(102, 126, 234, 0.3);
  color:#8bb3ff;
}
body.theme-dark .rq-btn:hover{
  background:rgba(102, 126, 234, 0.25);
  border-color:rgba(102, 126, 234, 0.5);
  color:#e8f0ff;
}
body.theme-dark .chat-message .copy-btn{
  color:#8bb3ff;
}
body.theme-dark .quick-prompts-container {
  background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(76, 29, 149, 0.3) 100%);
  border: 1px solid rgba(102, 126, 234, 0.2);
}
body.theme-dark .quick-prompts-label {
  color: #bfdbfe;
}
body.theme-dark .quick-prompt-btn {
  background: rgba(30, 41, 59, 0.8);
  border-color: rgba(102, 126, 234, 0.4);
  color: #cbd5e1;
}
body.theme-dark .quick-prompt-btn:hover {
  background: #667eea;
  color: white;
  border-color: #667eea;
}
body.theme-dark .related-btn{
  background:rgba(102, 126, 234, 0.1);
  border:1px solid rgba(102, 126, 234, 0.3);
  color:var(--ink);
}
/* Grades buttons */
body.theme-dark .gbtn{
  background:rgba(15,23,41,0.8);
  color:var(--ink);
  border:1px solid rgba(102,126,234,0.3);
}
body.theme-dark .gbtn:hover{
  background:rgba(102,126,234,0.25);
  border-color:rgba(102,126,234,0.5);
  box-shadow:0 0 20px rgba(102,126,234,0.35);
}
body.theme-dark .related-btn:hover{
  background:rgba(102, 126, 234, 0.25);
  border-color:rgba(102, 126, 234, 0.5);
  box-shadow:0 0 20px rgba(102, 126, 234, 0.4);
}

/* Ultra-premium theme toggle button */
.theme-toggle{
  position:relative;
  border:2px solid rgba(102, 126, 234, 0.4); 
  background:linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); 
  backdrop-filter:blur(10px);
  color:#fff; 
  padding:10px 20px; 
  border-radius:30px; 
  font-weight:800; 
  font-size:0.9rem;
  cursor:pointer;
  box-shadow:0 4px 15px rgba(102, 126, 234, 0.3), inset 0 0 20px rgba(102, 126, 234, 0.1);
  overflow:hidden;
}
.theme-toggle::before{
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(135deg, rgba(118, 75, 162, 0.3), rgba(102, 126, 234, 0.3));
  opacity:0;
  transition:opacity 0.3s ease;
}
.theme-toggle:hover{
  transform:translateY(-3px) scale(1.05);
  border-color:rgba(102, 126, 234, 0.8);
  box-shadow:0 8px 30px rgba(102, 126, 234, 0.5), 0 0 40px rgba(118, 75, 162, 0.3), inset 0 0 30px rgba(102, 126, 234, 0.2);
}
.theme-toggle:hover::before{opacity:1}
.theme-toggle:active{
  transform:translateY(-1px) scale(1.02);
}
body.theme-dark .theme-toggle{
  background:linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 4px 15px rgba(102, 126, 234, 0.4), 0 0 30px rgba(102, 126, 234, 0.2), inset 0 0 20px rgba(102, 126, 234, 0.15);
}
/* ===== Shared top bar ===== */
.topbar{
  position:sticky; top:0; z-index:100; display:flex; align-items:center; justify-content:space-between; gap:10px;
  background:linear-gradient(90deg,var(--navy),#07386c 60%,var(--navy)); color:#fff; padding:10px 14px; box-shadow:0 2px 0 rgba(0,0,0,.06)
}
.brand{display:flex; align-items:center; gap:12px}
.brand h1{margin:0; font-weight:900; letter-spacing:.2px; line-height:1.05}
.pillars-line{margin:2px 0 0 0; font-size:12px; color:#e6e9f5; letter-spacing:.08em}
.brandstack{display:flex; flex-direction:column}
.logo{width:42px; height:42px; display:flex; align-items:center; justify-content:center; background:transparent}
.logo img{width:100%; height:100%; object-fit:contain; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2))}
.top-actions{display:flex; gap:8px; align-items:center}
.signout{border:1px solid rgba(255,255,255,.25); background:rgba(255,255,255,.10); color:#fff; padding:8px 12px; border-radius:999px; font-weight:800; cursor:pointer}

/* ===== Tabs ===== */
.nav{position:sticky; top:58px; z-index:95; display:flex; gap:8px; padding:8px 12px; background:#fff; border-bottom:1px solid var(--rail); backdrop-filter:blur(10px); box-shadow:0 2px 8px rgba(0,0,0,0.04)}
.tab{padding:8px 12px; border-radius:999px; border:1px solid var(--rail); background:#fff; cursor:pointer; font-weight:800; color:#0b2249; transition:all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); position:relative; overflow:hidden}
.tab::after{
  content:"";
  position:absolute;
  bottom:0;
  left:50%;
  width:0;
  height:3px;
  background:linear-gradient(90deg,var(--navy),var(--navy-2));
  transform:translateX(-50%);
  transition:width 0.3s ease;
  border-radius:3px 3px 0 0;
}
.tab:hover{background:#f5f7fb; transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.08)}
.tab:hover::after{width:80%}
.tab.active{background:linear-gradient(90deg,var(--navy),var(--navy-2)); color:#fff; border-color:transparent; box-shadow:0 4px 16px rgba(0,51,102,0.3)}
.tab.active::after{width:0}

/* ===== Pages ===== */
.page{min-height:calc(100dvh - 120px); padding:18px 12px 18px; display:none}
.page.active{display:block}
.hero{display:flex; align-items:flex-end; justify-content:space-between; gap:12px; margin:0 auto 12px; max-width:1200px}
.hero h2{margin:0; font-size:1.7rem}
.hero .meta{color:var(--muted); font-size:.95rem}
.container{max-width:1200px; margin:0 auto}

/* ===== Panels ===== */
.panel{background:var(--panel); border:1px solid var(--rail); border-radius:var(--radius); box-shadow:var(--shadow)}
.p-body{padding:12px 14px}

/* ===== Schedule (shared style) - Ultra Premium Enhanced ===== */
.schedule-wrap{max-width:1200px; margin:0 auto}
.summary{display:flex; align-items:center; gap:16px; flex-wrap:wrap; padding:16px 0; margin-bottom:8px}
.progress{flex:1; height:14px; background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius:999px; overflow:hidden; position:relative; box-shadow:inset 0 2px 6px rgba(15,23,41,.12); border:1px solid rgba(0,0,0,0.05)}
.progress > b{display:block; height:100%; background:linear-gradient(90deg, #3b82f6, #60a5fa, #93c5fd); box-shadow:0 2px 8px rgba(59,130,246,0.25)}
/* Segmented progress: green fill for done, blue marker for now */
.p-done{position:absolute; left:0; top:0; background:linear-gradient(90deg, #3b82f6, #60a5fa); width:0%; box-shadow:0 2px 8px rgba(59,130,246,0.25)}
.p-now{position:absolute; top:0; width:6px; background:#facc15; border-radius:4px; box-shadow:0 0 0 2px #fff inset, 0 0 16px rgba(250,204,21,.8)}
.legend{display:flex; gap:14px; flex-wrap:wrap}
.lg{display:flex; align-items:center; gap:10px; font-size:14px; color:#334155; font-weight:600}
.sw{width:14px; height:14px; border-radius:5px; display:inline-block; box-shadow:0 3px 6px rgba(0,0,0,0.2)}
/* New color key: done=green, now=yellow, up=blue */
.sw.done{background:linear-gradient(135deg, #22c55e, #16a34a)} /* green */
.sw.now{background:linear-gradient(135deg, #facc15, #eab308)}  /* yellow */
.sw.up{background:linear-gradient(135deg, #3b82f6, #2563eb)}   /* blue */

.timeline{position:relative; padding:16px 0 0; overflow:clip}
.rail{position:absolute; left:26px; top:0; bottom:0; width:5px; background:linear-gradient(180deg, #e0e7ff 0%, #dbeafe 50%, #e0f2fe 100%); border-radius:3px; box-shadow:0 2px 8px rgba(59,130,246,0.1)}
.now-indicator{position:absolute; left:12px; width:28px; height:28px; border-radius:50%; transform:translateY(-14px); box-shadow:0 10px 30px rgba(250, 204, 21, .6); background:radial-gradient(circle at 30% 30%, #fde047 0, #facc15 60%, #eab308 100%); border:4px solid white; animation:indicatorPulse 3s infinite}
@keyframes indicatorPulse{0%,100%{transform:translateY(-14px) scale(1); box-shadow:0 10px 30px rgba(250,204,21,.6)}50%{transform:translateY(-14px) scale(1.1); box-shadow:0 12px 40px rgba(250,204,21,.8)}}

.timeline .slot{position:relative; padding-left:70px; margin:22px 0; border:2px solid #e2e8f0; background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius:24px; box-shadow:0 8px 20px rgba(0,0,0,.08); transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow:hidden}
.slot:hover{transform:translateY(-6px) scale(1.015); box-shadow:0 16px 40px rgba(0,0,0,.15); border-color:#cbd5e1}
.slot:last-child{border-bottom:2px solid #e2e8f0}
.slot::before{content:""; position:absolute; left:0; top:0; bottom:0; width:12px; border-radius:24px 0 0 24px; transition:all 0.4s ease; box-shadow:inset -3px 0 10px rgba(0,0,0,0.12)}
.slot:hover::before{width:16px; box-shadow:inset -4px 0 14px rgba(0,0,0,0.18)}
.slot.now::before{background:linear-gradient(180deg, #fef08a, #fde047, #facc15); box-shadow:inset -3px 0 10px rgba(250,204,21,0.4), 0 0 24px rgba(250,204,21,0.4)}   /* yellow with glow */
.slot.up::before{background:linear-gradient(180deg, #93c5fd, #60a5fa, #3b82f6); box-shadow:inset -3px 0 10px rgba(59,130,246,0.4)}     /* blue */
.slot.done::before{background:linear-gradient(180deg, #86efac, #4ade80, #22c55e); box-shadow:inset -3px 0 10px rgba(34,197,94,0.4)}   /* green */
.dot{position:absolute; left:19px; top:50%; transform:translateY(-50%); width:18px; height:18px; border-radius:50%; background:#cbd5e1; box-shadow:0 5px 14px rgba(0,0,0,.25), 0 0 0 4px white; border:3px solid white}
.slot.now .dot{background:#facc15; box-shadow:0 5px 14px rgba(250,204,21,.7), 0 0 20px rgba(250,204,21,.5), 0 0 0 4px white; animation:pulse 2.5s infinite}  /* yellow with enhanced glow */
.slot.up .dot{background:#3b82f6; box-shadow:0 5px 14px rgba(59,130,246,.5), 0 0 0 4px white}  /* blue */
.slot.done .dot{background:#22c55e; box-shadow:0 5px 14px rgba(34,197,94,.5), 0 0 0 4px white} /* green */
@keyframes pulse{0%,100%{box-shadow:0 5px 14px rgba(250,204,21,.7), 0 0 20px rgba(250,204,21,.5), 0 0 0 4px white}50%{box-shadow:0 7px 18px rgba(250,204,21,.95), 0 0 32px rgba(250,204,21,.7), 0 0 0 4px white}}
.slot-inner{display:grid; grid-template-columns:180px 1fr; gap:28px; align-items:center; padding:24px 32px}
.time{font-size:1.1rem; color:#475569; font-weight:800; white-space:nowrap; letter-spacing:-0.03em; font-family:ui-monospace, 'SF Mono', Monaco, 'Cascadia Code', monospace}
.cls{font-weight:900; color:#0f172a; font-size:1.2rem; line-height:1.4; letter-spacing:-0.015em; text-shadow:0 1px 2px rgba(0,0,0,0.05)}
.meta{color:#64748b; font-size:1rem; margin-top:8px; font-weight:500; letter-spacing:-0.01em}
/* (removed) per-slot mini progress; showing Ends-in near global progress bar instead */
.badge{display:inline-block; padding:3px 10px; border-radius:999px; font-size:.78rem; font-weight:900; border:1px solid}
.badge.now{background:#eafff4; color:#0f7a56; border-color:#bfe7cf}
.badge.up{background:#eef5ff; color:#17497f; border-color:#cfe0ff}
.badge.done{background:#f7f8fb; color:#4b5568; border-color:#e4e9f3}
.weekend{text-align:center; padding:40px 16px; color:#4a5672}
.weekend h3{margin:0 0 8px 0; font-size:1.3rem}
.weekend .sub{color:#6a7690}

/* Mini current class card — identical styling to main slot */
.slot-mini{
  position:relative; padding-left:70px; margin:6px 0; /* tighter vertical for header */
  border:2px solid #e2e8f0; background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius:24px; box-shadow:0 8px 20px rgba(0,0,0,.08);
  transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1); overflow:hidden;
  display:block; flex:0 1 680px; max-width:680px;
}
/* Use the same grid and typography as main slot (inherit global .slot-inner, .time, .cls, .meta) */
/* No overrides needed for .slot-mini .slot-inner/.time/.cls/.meta */
/* Dot uses global sizing/position */
.slot-mini::before{border-radius:24px 0 0 24px}
.slot-mini.hidden{display:none!important}

/* Big date + day navigation - Premium upgrade */
.bigdate{font-weight:900; font-size:1.8rem; text-align:center; margin:16px 0 12px 0; color:#0f172a; letter-spacing:-0.02em; text-shadow:0 2px 4px rgba(0,0,0,0.05)}
.daynav{display:flex; justify-content:center; align-items:center; gap:12px; margin:12px 0 16px 0}
.daybtn{border:2px solid #e2e8f0; background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); color:#0f172a; border-radius:16px; padding:12px 20px; cursor:pointer; font-weight:800; font-size:0.95rem; transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow:0 2px 8px rgba(0,0,0,0.04)}
.daybtn:hover{background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.08); border-color:#cbd5e1}

/* Day-change animations disabled for performance */

/* ===== Student-only modules - Premium Upgrade ===== */
.toolbar{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px}
.input, select{
  border:2px solid #e2e8f0;
  border-radius:14px;
  padding:12px 16px;
  background:#ffffff;
  font:inherit;
  font-size:0.95rem;
  transition:all 0.3s ease;
  box-shadow:0 2px 6px rgba(0,0,0,0.04);
}
.input:focus, select:focus{
  outline:none;
  border-color:#3b82f6;
  box-shadow:0 0 0 4px rgba(59,130,246,0.15), 0 4px 16px rgba(59,130,246,0.2), 0 8px 24px rgba(0,0,0,0.1);
  transform:translateY(-1px);
}
.btn{
  border:2px solid #e2e8f0;
  background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius:14px;
  padding:12px 20px;
  font-weight:800;
  font-size:0.95rem;
  cursor:pointer;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 2px 8px rgba(0,0,0,0.04);
}
.btn:hover{
  background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  border-color:#cbd5e1;
}
.btn.primary{
  background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color:#fff;
  border-color:transparent;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}
.btn.primary:hover{
  background:linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  box-shadow:0 6px 16px rgba(59,130,246,0.4);
}
.board{display:grid; gap:14px}
.card{
  border:2px solid #e2e8f0;
  background:#ffffff;
  border-radius:18px;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  padding:18px 20px;
  display:grid;
  grid-template-columns:1fr 120px 110px 80px;
  gap:14px;
  align-items:center;
  transition:all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  position:relative;
  overflow:hidden;
}
.card::before{
  content:"";
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(59,130,246,0.1), transparent);
  transition:left 0.6s ease;
}
.card:hover::before{
  left:100%;
}
.card:hover{
  transform:translateY(-4px) scale(1.01);
  box-shadow:0 12px 32px rgba(0,0,0,0.14), 0 0 0 1px rgba(59,130,246,0.1);
  border-color:#93c5fd;
}
@media(max-width:900px){.card{grid-template-columns:1fr 110px 100px}}
@media(max-width:640px){.card{grid-template-columns:1fr}}
.card .h{font-weight:900; font-size:1.05rem; color:#0f172a; letter-spacing:-0.01em}
.card .sub{color:#64748b; font-size:.95rem; margin-top:4px}
.tag{
  display:inline-block;
  padding:6px 12px;
  border-radius:12px;
  font-size:.85rem;
  font-weight:800;
  border:2px solid;
  letter-spacing:0.02em;
  transition:all 0.3s ease;
  cursor:default;
}
.tag:hover{
  transform:scale(1.05);
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
}
.tag.open{background:#fef2f2;color:#dc2626;border-color:#fecaca}
.tag.open:hover{background:#fee2e2;box-shadow:0 4px 12px rgba(220,38,38,0.2)}
.tag.doing{background:#fefce8;color:#ca8a04;border-color:#fef08a}
.tag.doing:hover{background:#fef3c7;box-shadow:0 4px 12px rgba(202,138,4,0.2)}
.tag.done{background:#f0fdf4;color:#16a34a;border-color:#bbf7d0}
.tag.done:hover{background:#dcfce7;box-shadow:0 4px 12px rgba(22,163,74,0.2)}

.gpa{
  display:flex;
  align-items:center;
  gap:16px;
  border:2px solid #e2e8f0;
  background:linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
  border-radius:20px;
  box-shadow:0 6px 16px rgba(0,0,0,0.06);
  padding:20px 24px;
  margin-bottom:16px;
  transition:all 0.3s ease;
}
.gpa:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 24px rgba(0,0,0,0.1);
  border-color:#cbd5e1;
}
.gpa-badge{
  min-width:90px;
  text-align:center;
  font-weight:900;
  font-size:1.1rem;
  color:#1e40af;
  background:linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
  border:2px solid #93c5fd;
  border-radius:16px;
  padding:14px 16px;
  letter-spacing:-0.01em;
  box-shadow:0 4px 12px rgba(59,130,246,0.15);
}
.gpa-track{
  flex:1;
  height:16px;
  background:#e2e8f0;
  border-radius:999px;
  overflow:hidden;
  box-shadow:inset 0 2px 4px rgba(0,0,0,0.08);
}
.gpa-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);
  border-radius:999px;
  transition:width .8s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 0 12px rgba(59,130,246,0.4);
}
.gpa-meta{
  font-size:.95rem;
  color:#475569;
  min-width:170px;
  text-align:right;
  font-weight:600;
}

.grid3{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; align-items:stretch}
/* Ensure all grid items (grade cards) stretch to equal height so buttons align across the row */
.grid3 > *{height:100%}
@media(max-width:900px){.grid3{grid-template-columns:repeat(2,1fr)}}
@media(max-width:640px){.grid3{grid-template-columns:1fr}}
.gcard{
  border:2px solid #e2e8f0;
  background:#ffffff;
  border-radius:20px;
  box-shadow:0 6px 16px rgba(0,0,0,0.06);
  padding:20px;
  transition:all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  position:relative;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  height:100%;
}
.gcard::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:5px;
  background:linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
  opacity:0;
  transition:opacity 0.3s ease;
}
.gcard:hover::before{
  opacity:1;
}
.gcard:hover{
  transform:translateY(-4px) scale(1.02);
  box-shadow:0 12px 32px rgba(0,0,0,0.12);
  border-color:#cbd5e1;
}
.gheader{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:12px}
.gtitle{margin:0; font-weight:900; font-size:1.1rem; color:#0f172a; letter-spacing:-0.01em}
.ggrade{font-weight:900; font-size:1.15rem; color:#3b82f6; letter-spacing:-0.01em}
.bar-wrap{height:10px; background:#e2e8f0; border-radius:999px; overflow:hidden; margin:12px 0; box-shadow:inset 0 2px 4px rgba(0,0,0,0.06)}
.bar{height:100%; width:0%; border-radius:999px; background:linear-gradient(90deg, #22c55e 0%, #16a34a 100%); transition:width .8s cubic-bezier(0.4, 0, 0.2, 1); box-shadow:0 0 8px rgba(34,197,94,0.3)}
.gsub{color:#64748b; font-size:.95rem; margin-bottom:12px; font-weight:500}
.gbtn{
  margin-top:auto;
  padding:12px 16px;
  border-radius:14px;
  border:2px solid #e2e8f0;
  background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  cursor:pointer;
  font-weight:800;
  font-size:0.9rem;
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow:0 2px 6px rgba(0,0,0,0.04);
  width:100%;
}
.gbtn:hover{
  background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
  border-color:#cbd5e1;
}

/* ===== Directory - Premium Upgrade ===== */
.dir-tabs{display:flex; gap:10px; margin-bottom:14px}
.dir-tabs .btn.active{
  background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color:#fff;
  border-color:transparent;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}
.dir-tools{display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px}
.dir-grid{display:grid; grid-template-columns:repeat(2,1fr); gap:14px}
@media(max-width:900px){.dir-grid{grid-template-columns:1fr}}
.person{
  border:2px solid #e2e8f0;
  background:#ffffff;
  border-radius:18px;
  padding:18px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 4px 12px rgba(0,0,0,0.06);
  transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.person:hover{
  transform:translateY(-3px);
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
  border-color:#cbd5e1;
}
.person .name{font-weight:900; font-size:1.05rem; color:#0f172a; letter-spacing:-0.01em}
.person .meta{color:#64748b; font-size:.95rem; margin-top:4px; font-weight:500}
.mail{
  padding:10px 18px;
  border-radius:14px;
  background:linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  color:#fff;
  text-decoration:none;
  font-weight:700;
  font-size:0.9rem;
  transition:all 0.3s ease;
  box-shadow:0 4px 12px rgba(59,130,246,0.3);
}
.mail:hover{
  background:linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
  transform:translateY(-2px);
  box-shadow:0 6px 16px rgba(59,130,246,0.4);
}
.pager{display:flex; gap:10px; justify-content:flex-end; margin-top:14px}

/* ===== Modals (grade/settings) ===== */
.modal{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.35); z-index:1200}
.modal.hidden{display:none}
.modal .modal-content{width:min(560px,92vw); background:#fff; border-radius:14px; box-shadow:0 30px 60px rgba(0,0,0,.35); padding:16px}
.modal .close-btn{float:right; border:1px solid #d5dcf0; background:#fff; color:#0b2249; border-radius:10px; padding:6px 10px; cursor:pointer; font-weight:800}
/* Dark mode modal */
body.theme-dark .modal{background:rgba(0,0,0,.6)}
body.theme-dark .modal .modal-content{
  background:rgba(15,23,41,0.92);
  border:1px solid rgba(102,126,234,0.3);
  color:var(--ink);
  box-shadow:0 40px 80px rgba(0,0,0,.7), 0 0 40px rgba(102,126,234,0.2);
}
body.theme-dark .modal .close-btn{
  background:linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
  border:1px solid rgba(102,126,234,0.5);
  color:#fff;
}
body.theme-dark .modal .close-btn:hover{
  background:linear-gradient(135deg, rgba(102,126,234,0.35), rgba(118,75,162,0.35));
  box-shadow:0 0 20px rgba(102,126,234,0.4);
}


/* ===== Login Overlay ===== */
#login{
  position:fixed; 
  inset:0; 
  display:grid; 
  place-items:center; 
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  z-index:1000;
  animation: gradientShift 15s ease infinite;
}
@keyframes gradientShift {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}
.login-card{
  width:min(440px,94vw); 
  background:rgba(255,255,255,0.95); 
  backdrop-filter:blur(20px);
  border-radius:24px; 
  box-shadow:0 40px 80px rgba(0,0,0,.3), 0 0 0 1px rgba(255,255,255,0.2); 
  padding:40px 32px;
  animation:slideIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes slideIn{
  from { transform:translateY(30px) scale(0.95); opacity:0; }
  to { transform:translateY(0) scale(1); opacity:1; }
}
.login-head{display:flex; align-items:center; gap:16px; margin-bottom:12px}
.login-logo{
  width:72px; 
  height:72px; 
  display:flex; 
  align-items:center;
  justify-content:center;
  background:transparent;
}
.login-logo img{width:100%; height:100%; object-fit:contain; filter:drop-shadow(0 4px 8px rgba(0,0,0,0.15));}
.login-title{margin:0; font-size:1.75rem; font-weight:900; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;}
.login-sub{margin:4px 0 0 0; color:#6b7692; font-size:0.95rem;}
.login-form{display:grid; gap:16px; margin-top:24px}
.hint{font-size:.92rem; color:#555; font-weight:600; margin-bottom:-8px;}
.role-input{
  border:2px solid #e0e7ff; 
  border-radius:14px; 
  padding:14px 16px; 
  font:inherit; 
  font-size:1rem;
  transition:all 0.3s ease;
  background:#f9fafb;
}
.role-input:focus{
  outline:none; 
  border-color:#667eea; 
  background:#fff;
  box-shadow:0 0 0 4px rgba(102, 126, 234, 0.1);
}
.remember-me-wrapper{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:-6px;
}
.remember-me-label{
  display:flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  user-select:none;
}
.remember-me-checkbox{
  width:18px;
  height:18px;
  cursor:pointer;
  accent-color:#667eea;
}
.remember-me-text{
  font-size:0.9rem;
  color:#555;
  font-weight:500;
}
.login-btn{
  border:0; 
  border-radius:14px; 
  padding:16px 20px; 
  font-weight:800; 
  font-size:1.05rem;
  color:#fff; 
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  box-shadow:0 8px 20px rgba(102, 126, 234, 0.4);
  position:relative;
  overflow:hidden;
}
.login-btn::before{
  content:'';
  position:absolute;
  inset:0;
  background:linear-gradient(135deg, #764ba2 0%, #667eea 100%);
  opacity:0;
  transition:opacity 0.3s ease;
}
.login-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 12px 28px rgba(102, 126, 234, 0.5);
}
.login-btn:hover::before{
  opacity:1;
}
.login-btn:active{
  transform:translateY(0);
}
.btn-text, .btn-icon{
  position:relative;
  z-index:1;
}
.btn-icon{
  font-size:1.4rem;
  transition:transform 0.3s ease;
}
.login-btn:hover .btn-icon{
  transform:translateX(4px);
}
.shake{animation:shake .4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both}
@keyframes shake{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-6px)}40%,60%{transform:translateX(6px)}}

/* Customize button */
.customize-btn{
  border:2px solid rgba(102, 126, 234, 0.4);
  background:linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
  backdrop-filter:blur(10px);
  color:#667eea;
  padding:12px 18px;
  border-radius:12px;
  font-weight:700;
  font-size:0.95rem;
  cursor:pointer;
  transition:all 0.3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;
  margin-top:8px;
}
.customize-btn:hover{
  background:linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
  border-color:rgba(102, 126, 234, 0.6);
  transform:translateY(-2px);
  box-shadow:0 4px 15px rgba(102, 126, 234, 0.3);
  color:#764ba2;
}
body.theme-dark .customize-btn{
  color:#e8f0ff;
  border-color:rgba(102, 126, 234, 0.5);
}
body.theme-dark .customize-btn:hover{
  color:#fff;
}

/* Customization Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.8);
  backdrop-filter:blur(10px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10000;
  animation:fadeIn 0.3s ease;
}
@keyframes fadeIn{
  from{opacity:0}
  to{opacity:1}
}
.modal-content{
  background:rgba(255,255,255,0.95);
  backdrop-filter:blur(20px);
  border-radius:20px;
  width:min(600px,90vw);
  max-height:85vh;
  overflow-y:auto;
  box-shadow:0 30px 80px rgba(0,0,0,0.5), 0 0 60px rgba(102, 126, 234, 0.3);
  animation:slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes slideUp{
  from{transform:translateY(50px) scale(0.9); opacity:0}
  to{transform:translateY(0) scale(1); opacity:1}
}
.modal-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:24px 28px;
  border-bottom:2px solid rgba(102, 126, 234, 0.2);
}
.modal-header h2{
  margin:0;
  font-size:1.5rem;
  background:linear-gradient(135deg, #667eea, #764ba2);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
}
.modal-close{
  background:none;
  border:none;
  font-size:2rem;
  cursor:pointer;
  color:#666;
  transition:all 0.2s ease;
  padding:0;
  width:40px;
  height:40px;
  display:grid;
  place-items:center;
  border-radius:50%;
}
.modal-close:hover{
  background:rgba(102, 126, 234, 0.1);
  color:#667eea;
  transform:rotate(90deg);
}
.modal-body{
  padding:24px 28px;
  max-height:calc(85vh - 180px);
  overflow-y:auto;
}
.customize-section{
  margin-bottom:28px;
  padding-bottom:24px;
  border-bottom:1px solid rgba(0,0,0,0.08);
}
.customize-section:last-child{
  border-bottom:none;
}
.customize-section h3{
  margin:0 0 16px 0;
  font-size:1.1rem;
  color:#333;
}
.color-picker-group{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
}
.color-picker-group label{
  display:flex;
  flex-direction:column;
  gap:8px;
  font-weight:600;
  color:#555;
}
.color-picker-group input[type="color"]{
  width:100%;
  height:50px;
  border:2px solid rgba(102, 126, 234, 0.2);
  border-radius:10px;
  cursor:pointer;
  transition:all 0.3s ease;
}
.color-picker-group input[type="color"]:hover{
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 4px 15px rgba(102, 126, 234, 0.2);
}
.custom-select{
  width:100%;
  padding:12px 16px;
  border:2px solid rgba(102, 126, 234, 0.2);
  border-radius:10px;
  font-size:1rem;
  background:#fff;
  cursor:pointer;
  transition:all 0.3s ease;
}
.custom-select:focus{
  outline:none;
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 0 20px rgba(102, 126, 234, 0.2);
}
.schedule-times{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:14px;
}
.schedule-times label{
  display:flex;
  flex-direction:column;
  gap:6px;
  font-weight:600;
  color:#555;
  font-size:0.9rem;
}
.schedule-times input[type="time"]{
  padding:10px 12px;
  border:2px solid rgba(102, 126, 234, 0.2);
  border-radius:8px;
  font-size:1rem;
  transition:all 0.3s ease;
}
.schedule-times input[type="time"]:focus{
  outline:none;
  border-color:rgba(102, 126, 234, 0.6);
  box-shadow:0 0 15px rgba(102, 126, 234, 0.2);
}
.modal-footer{
  padding:20px 28px;
  border-top:2px solid rgba(102, 126, 234, 0.2);
  display:flex;
  gap:12px;
  justify-content:flex-end;
}
.btn-primary,.btn-secondary{
  padding:12px 24px;
  border-radius:10px;
  font-weight:700;
  font-size:1rem;
  cursor:pointer;
  transition:all 0.3s ease;
  border:none;
}
.btn-primary{
  background:linear-gradient(135deg, #667eea, #764ba2);
  color:#fff;
  box-shadow:0 4px 15px rgba(102, 126, 234, 0.4);
}
.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 6px 20px rgba(102, 126, 234, 0.6);
}
.btn-secondary{
  background:rgba(0,0,0,0.05);
  color:#555;
}
.btn-secondary:hover{
  background:rgba(0,0,0,0.1);
}
body.theme-dark .modal-content{
  background:rgba(15, 23, 41, 0.98);
  color:#e8f0ff;
}
body.theme-dark .modal-header{
  border-bottom-color:rgba(102, 126, 234, 0.3);
}
body.theme-dark .customize-section{
  border-bottom-color:rgba(102, 126, 234, 0.15);
}
body.theme-dark .customize-section h3{
  color:#e8f0ff;
}
body.theme-dark .color-picker-group label,
body.theme-dark .schedule-times label{
  color:#b4c0e0;
}
body.theme-dark .custom-select,
body.theme-dark .schedule-times input[type="time"]{
  background:rgba(12, 22, 48, 0.8);
  color:#e8f0ff;
  border-color:rgba(102, 126, 234, 0.3);
}
body.theme-dark .btn-secondary{
  background:rgba(102, 126, 234, 0.15);
  color:#e8f0ff;
}

/* ===== Hide/Show helpers ===== */
.hidden{display:none !important}

/* ===== Small UI chips (reusable) ===== */
.chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--rail); background:#fff; color:#0b2249; font-weight:800; font-size:.85rem; box-shadow:var(--shadow)}
.chip .dot{width:8px; height:8px; border-radius:50%}

/* PantherBot suggestions row */
.pb-suggestions{display:flex; flex-wrap:wrap; gap:8px; margin:10px auto 8px; max-width:850px}
.pb-suggestions .chip{cursor:pointer}

/* Back to top button */
#backToTop{position:fixed; right:16px; bottom:16px; z-index:1100; border:0; border-radius:999px; padding:10px 12px; font-weight:900; background:linear-gradient(90deg,var(--navy),var(--navy-2)); color:#fff; box-shadow:0 10px 30px rgba(0,0,0,.25); cursor:pointer; display:none}

/* PantherBot Chat Layout */
.chat-container {
  display: flex;
  flex-direction: column;
  height: 600px;
  background: linear-gradient(135deg, #ffffff 0%, #f5f8ff 100%);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 51, 102, 0.12);
  overflow: hidden;
  max-width: 850px;
  margin: 0 auto;
  border: 1px solid rgba(0, 51, 102, 0.08);
}

.chat-messages {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  background: linear-gradient(to bottom, #f9fbff 0%, #ffffff 100%);
  scroll-behavior: smooth;
  /* Make messages stack like a chat without floats */
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: flex-start;
}

.chat-message {
  margin-bottom: 0; /* handled by gap on container */
  line-height: 1.6;
  animation: fadeSlideIn 0.3s ease-out;
  display: inline-block;
  max-width: 75%;
  overflow-wrap: anywhere;
}

@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chat-message.user {
  color: #003366;
  font-weight: 600;
  background: linear-gradient(135deg, #e8f0ff 0%, #d4e4ff 100%);
  padding: 12px 18px;
  border-radius: 18px 18px 4px 18px;
  box-shadow: 0 2px 8px rgba(0, 51, 102, 0.1);
  text-align: left;
  align-self: flex-end;
  animation: slideInRight 0.3s ease-out;
}

.chat-message.bot {
  color: #1a2332;
  background: white;
  padding: 12px 18px;
  border-radius: 18px 18px 18px 4px;
  border: 1px solid rgba(0, 51, 102, 0.08);
  animation: slideInLeft 0.3s ease-out;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  text-align: left;
  align-self: flex-start;
}

/* Typing indicator state */
.chat-message.bot.typing {
  opacity: 0.9;
  color: #394a6b;
  position: relative;
  animation: pb-pulse 1.2s ease-in-out infinite, slideInLeft 0.3s ease-out;
}

@keyframes pb-pulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Small copy button inside bot bubbles */
.chat-message .copy-btn{
  margin-left: 8px;
  font-size: 12px;
  color: #4f87c7;
  background: transparent;
  border: 0;
  cursor: pointer;
}
.chat-message .copy-btn:hover{ text-decoration: underline; }

/* Quick Prompts */
.quick-prompts-container {
  margin: 16px 0;
  padding: 16px;
  background: linear-gradient(135deg, #e0f2fe 0%, #ddd6fe 100%);
  border-radius: 12px;
  animation: fadeInUp 0.4s ease-out;
}
.quick-prompts-label {
  font-weight: 600;
  color: #1e293b;
  margin-bottom: 12px;
  font-size: 14px;
}
.quick-prompt-btn {
  display: inline-block;
  margin: 4px;
  padding: 8px 14px;
  background: white;
  border: 1px solid #cbd5e1;
  border-radius: 20px;
  font-size: 13px;
  color: #334155;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
}
.quick-prompt-btn:hover {
  background: #3b82f6;
  color: white;
  border-color: #3b82f6;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

/* Citations */
.citations {
  margin: 8px 0;
  padding: 8px 12px;
  background: #f0f4f8;
  animation: fadeInUp 0.4s ease-out;
  border-radius: 8px;
  font-size: 13px;
}
.cite-label {
  font-weight: 600;
  color: #333;
  margin-bottom: 6px;
}
.cite-link {
  display: inline-block;
  margin-right: 12px;
  color: #4f87c7;
  text-decoration: none;
  font-size: 12px;
}
.cite-link:hover {
  text-decoration: underline;
}

/* Related Questions */
.related-questions {
  margin: 8px 0;
  padding: 8px 12px;
  background: #fafcfe;
  border-radius: 8px;
  animation: fadeInUp 0.5s ease-out;
}
.rq-label {
  font-size: 13px;
  font-weight: 600;
  color: #555;
  margin-bottom: 6px;
}
.rq-btn {
  display: inline-block;
  margin: 4px 6px 4px 0;
  padding: 6px 12px;
  font-size: 13px;
  color: #4f87c7;
  background: white;
  border: 1px solid #d0dce8;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.2s;
  animation: fadeInUp 0.4s ease-out backwards;
}
.rq-btn:nth-child(2) { animation-delay: 0.1s; }
.rq-btn:nth-child(3) { animation-delay: 0.2s; }
.rq-btn:nth-child(4) { animation-delay: 0.3s; }
.rq-btn:hover {
  background: #e8f2ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(79, 135, 199, 0.2);
  border-color: #4f87c7;
}

.chat-input {
  display: flex;
  gap: 12px;
  padding: 16px;
  background: white;
  border-top: 1px solid rgba(0, 51, 102, 0.1);
  box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.03);
}

.chat-input input {
  flex: 1;
  padding: 14px 18px;
  border: 2px solid rgba(0, 51, 102, 0.12);
  border-radius: 24px;
  outline: none;
  font-size: 15px;
  font-family: Inter, sans-serif;
  background: #f9fbff;
  transition: all 0.2s ease;
}

.chat-input input:focus {
  border-color: #003366;
  background: white;
  box-shadow: 0 0 0 4px rgba(0, 51, 102, 0.08);
}

#voiceBtn {
  background: linear-gradient(135deg, #7c3aed 0%, #9333ea 100%);
  color: white;
  border: none;
  padding: 14px 20px;
  cursor: pointer;
  font-size: 20px;
  border-radius: 24px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.25);
  min-width: 54px;
}

#voiceBtn:hover {
  background: linear-gradient(135deg, #9333ea 0%, #a855f7 100%);
  transform: translateY(-1px) scale(1.05);
  box-shadow: 0 6px 16px rgba(124, 58, 237, 0.35);
}

#voiceBtn:active, #voiceBtn.listening {
  transform: scale(0.95);
  animation: voicePulse 1s ease-in-out infinite;
}

@keyframes voicePulse {
  0%, 100% { box-shadow: 0 4px 12px rgba(124, 58, 237, 0.25); }
  50% { box-shadow: 0 4px 20px rgba(124, 58, 237, 0.6); }
}

.chat-input button {
  background: linear-gradient(135deg, #003366 0%, #004d99 100%);
  color: white;
  border: none;
  padding: 14px 32px;
  cursor: pointer;
  font-size: 15px;
  font-weight: 700;
  border-radius: 24px;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0, 51, 102, 0.25);
}

.chat-input button:hover {
  background: linear-gradient(135deg, #004d99 0%, #0066cc 100%);
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(0, 51, 102, 0.35);
}

.chat-input button:active {
  transform: translateY(0);
}

/* ===== MOBILE OPTIMIZATIONS (iPhone 16 Pro Max & All Mobile) ===== */
@media (max-width: 768px) {
  /* Typography scaling */
  body {
    font-size: 16px;
    line-height: 1.5;
  }
  
  h2 {
    font-size: 24px;
  }
  
  h3 {
    font-size: 18px;
  }
  
  /* Touch-friendly spacing */
  .container {
    padding: 16px;
  }
  
  /* Header optimization */
  .topbar {
    padding: 12px 16px;
    flex-wrap: wrap;
    gap: 12px;
  }
  
  .brand {
    flex-direction: row;
    align-items: center;
    gap: 12px;
    width: 100%;
  }
  
  .logo {
    width: 36px;
    height: 36px;
    flex-shrink: 0;
  }
  
  .brandstack h1 {
    font-size: 18px;
    margin: 0;
  }
  
  .pillars-line {
    font-size: 11px;
  }
  
  .top-actions {
    width: 100%;
    display: flex;
    gap: 8px;
    justify-content: stretch;
  }
  
  .top-actions button {
    flex: 1;
    padding: 10px 12px;
    font-size: 14px;
    white-space: nowrap;
  }
  
  /* Navigation tabs */
  .nav {
    padding: 8px 12px;
    gap: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  
  .nav::-webkit-scrollbar {
    display: none;
  }
  
  .tab {
    padding: 12px 20px;
    font-size: 15px;
    min-width: max-content;
    flex-shrink: 0;
  }
  
  /* Main content padding */
  #dashboard-student {
    padding-bottom: 32px;
  }
  
  /* Hero section */
  .hero {
    flex-direction: column;
    gap: 12px;
    align-items: flex-start;
  }
  
  .hero h2 {
    margin-bottom: 4px;
  }
  
  /* Schedule panel */
  .panel {
    padding: 16px;
    border-radius: 12px;
  }
  
  .summary {
    flex-direction: column;
    gap: 12px;
  }
  
  .day-progress-area {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 12px !important;
  }
  
  .legend {
    margin-left: 0 !important;
    justify-content: flex-start;
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .legend .lg {
    font-size: 13px;
  }
  
  /* Timeline slots */
  .timeline {
    gap: 12px;
  }
  
  .slot {
    padding: 16px;
    border-radius: 12px;
  }
  
  .t-main {
    font-size: 17px;
  }
  
  .t-sub {
    font-size: 14px;
  }
  
  .t-time {
    font-size: 13px;
  }
  
  /* Day navigation */
  .day-nav {
    flex-direction: column;
    gap: 12px;
  }
  
  .dn-center {
    order: -1;
    width: 100%;
  }
  
  .dn-left, .dn-right {
    width: 48%;
  }
  
  /* Assignment cards */
  .card {
    padding: 16px;
    border-radius: 12px;
  }
  
  .card-title {
    font-size: 16px;
  }
  
  .tag {
    font-size: 12px;
    padding: 4px 10px;
  }
  
  /* Grade cards */
  .gcard {
    padding: 18px;
    border-radius: 12px;
  }
  
  .gcard .gtitle {
    font-size: 16px;
  }
  
  .gcard .gbig {
    font-size: 32px;
  }
  
  .gbtn {
    padding: 12px;
    font-size: 15px;
    border-radius: 10px;
  }
  
  /* Directory cards */
  .dir-card {
    padding: 16px;
    border-radius: 12px;
  }
  
  .dir-title {
    font-size: 16px;
  }
  
  /* Login screen */
  .login-card {
    width: calc(100% - 32px);
    max-width: 100%;
    margin: 16px;
    padding: 24px;
    border-radius: 16px;
  }
  
  .login-logo img {
    width: 60px;
    height: 60px;
  }
  
  .login-title {
    font-size: 24px;
  }
  
  .login-sub {
    font-size: 14px;
  }
  
  .role-input {
    font-size: 16px;
    padding: 14px 16px;
    border-radius: 12px;
  }
  
  .login-btn {
    padding: 16px;
    font-size: 17px;
    border-radius: 12px;
  }
  
  .customize-btn {
    padding: 12px;
    font-size: 15px;
  }
  
  /* PantherBot Chat */
  .chat-container {
    height: calc(100vh - 180px);
    min-height: 500px;
    border-radius: 12px;
    margin: 0 8px;
  }
  
  .chat-header {
    padding: 16px;
    border-radius: 12px 12px 0 0;
  }
  
  .chat-header h3 {
    font-size: 18px;
  }
  
  .chat-messages {
    padding: 16px 12px;
    gap: 12px;
  }
  
  .chat-message {
    padding: 12px 16px;
    border-radius: 16px;
    font-size: 15px;
    line-height: 1.5;
  }
  
  .chat-message.user,
  .chat-message.bot {
    max-width: 85%;
  }
  
  .chat-input {
    padding: 12px;
    gap: 10px;
  }
  
  .chat-input input {
    font-size: 16px;
    padding: 12px 16px;
    border-radius: 12px;
  }
  
  .chat-input button {
    padding: 12px 18px;
    font-size: 15px;
  }
  
  .pb-suggestions {
    padding: 12px;
    gap: 8px;
  }
  
  .pb-suggestions .chip {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  .citations {
    padding: 12px;
    font-size: 13px;
  }
  
  .related-questions {
    padding: 12px;
  }
  
  .rq-btn {
    padding: 12px 16px;
    font-size: 14px;
    border-radius: 10px;
  }
  
  /* Buttons and interactive elements - larger touch targets */
  button, .btn, .chip {
    min-height: 44px;
    cursor: pointer;
  }
  
  /* Better scrolling */
  .timeline, .card-list, .grid3, .dir-grid {
    -webkit-overflow-scrolling: touch;
  }
  
  /* Fix grid layouts */
  .grid3 {
    gap: 12px;
  }
}

/* ===== iPhone Pro Max specific (430px width) ===== */
@media (max-width: 430px) {
  body {
    font-size: 15px;
  }
  
  .topbar {
    padding: 10px 12px;
  }
  
  .brandstack h1 {
    font-size: 16px;
  }
  
  .pillars-line {
    font-size: 10px;
  }
  
  .nav {
    padding: 6px 8px;
  }
  
  .tab {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  .container {
    padding: 12px;
  }
  
  .panel {
    padding: 14px;
  }
  
  .slot {
    padding: 14px;
  }
}

/* ===== Landscape mode optimizations ===== */
@media (max-height: 500px) and (orientation: landscape) {
  .topbar {
    padding: 8px 12px;
  }
  
  .brand {
    gap: 8px;
  }
  
  .logo {
    width: 32px;
    height: 32px;
  }
  
  .brandstack h1 {
    font-size: 16px;
  }
  
  .pillars-line {
    display: none;
  }
  
  .nav {
    padding: 6px 8px;
  }
  
  .tab {
    padding: 8px 14px;
  }
  
  .chat-container {
    height: calc(100vh - 120px);
  }
}



</style>
</head>
<body>

<!-- ===== LOGIN OVERLAY ===== -->
<section id="login" aria-label="Login">
  <div class="login-card" id="loginCard">
    <div class="login-head">
      <div class="login-logo">
        <img src="../portledge_crest.png" alt="Portledge crest" onerror="if(!this.dataset.fallback){this.dataset.fallback='svg';this.src='../portledge_crest.svg';}else{this.style.display='none';}">
      </div>
      <div>
        <h2 class="login-title">Welcome Back</h2>
        <p class="login-sub">Sign in to your Portledge Dashboard</p>
      </div>
    </div>
    <div class="login-form">
      <label for="role" class="hint">Enter your Portledge email:</label>
      <input id="role" class="role-input" type="email" placeholder="yourname.year@portledge.org" autocomplete="email" />
      
      <button id="loginBtn" class="login-btn">
        <span class="btn-text">Sign In</span>
        <span class="btn-icon">→</span>
      </button>
      
      <button id="customizeLoginBtn" class="customize-btn" type="button">
        <span>⚙️ Customize</span>
      </button>
    </div>
  </div>
</section>

<!-- ===== STUDENT DASHBOARD ===== -->
<header id="top-student" class="topbar hidden" role="banner">
  <div class="brand">
    <div class="logo"><img src="../portledge_crest.png" alt="Portledge crest" onerror="if(!this.dataset.fallback){this.dataset.fallback='svg';this.src='../portledge_crest.svg';}else{this.style.display='none';}"></div>
    <div class="brandstack">
      <h1>Portledge Dashboard — Student</h1>
      <div class="pillars-line">Kindness • Honor • Purpose • Respect</div>
    </div>
  </div>
  <div class="top-actions">
  <button class="signout" id="signOutStudent">Sign Out</button>
  <button id="themeToggle" class="theme-toggle" title="Toggle theme" aria-pressed="false">Dark Mode</button>
  <button id="customizeDashboardBtn" class="theme-toggle" title="Customize" style="margin-left:8px">⚙️ Customize</button>
  <button id="tempSettingsBtn" class="theme-toggle" title="Temp Settings" style="margin-left:8px">⏱️ Temp</button>
</div>


</header>
<nav id="nav-student" class="nav hidden" role="tablist" aria-label="Student">
  <button class="tab active" data-page="s-schedule" aria-selected="true">Schedule</button>
  <button class="tab" data-page="s-assign" aria-selected="false">Assignments</button>
  <button class="tab" data-page="s-grades" aria-selected="false">Grades</button>
  <button class="tab" data-page="s-directory" aria-selected="false">Directory</button>
  <button class="tab" data-page="s-pantherbot" aria-selected="false">PantherBot</button>


  
</nav>
<main id="dashboard-student" class="hidden">
  <!-- SCHEDULE -->
  <section id="page-s-schedule" class="page active">
    <div class="hero container">
      <div>
        <h2>My Day</h2>
        <div class="meta" id="s_todayMeta">—</div>
      </div>
      <div class="meta" id="s_daySummary">—</div>
    </div>
    <div class="schedule-wrap">
      <section class="panel">
        <div class="p-body">
          <div class="summary">
                <div class="day-progress-area" style="display:flex;align-items:center;gap:12px;flex:1">
                  <!-- Mini current class card (top-left) - always yellow/orange -->
                  <div id="miniCurrent" class="slot slot-mini hidden now" style="margin-right:12px;">
                    <div class="dot"></div>
                    <div class="slot-inner">
                      <div>
                        <div class="time" id="miniTime">—</div>
                      </div>
                      <div>
                        <div class="cls" id="miniCls">—</div>
                        <div class="meta" id="miniMeta"></div>
                      </div>
                    </div>
                  </div>
                  <div class="day-progress-wrap" style="display:none;flex:1;align-items:center">
                    <div class="day-progress" style="flex:1;margin-right:8px"><i style="width:0%"></i></div>
                    <!-- Blank space for future content -->
                  </div>
                  <div class="legend" style="margin-left:auto;">
                    <span class="lg"><i class="sw now"></i> Now</span>
                    <span class="lg"><i class="sw up"></i> Upcoming</span>
                    <span class="lg"><i class="sw done"></i> Done</span>
                  </div>
                </div>
          </div>
        </div>
        <div class="bigdate" id="s_bigDate">—</div>
        <div class="daynav">
          <button id="s_prev" class="daybtn" aria-label="Previous day">◀</button>
          <button id="s_today" class="daybtn" aria-label="Today">Today</button>
          <button id="s_next" class="daybtn" aria-label="Next day">▶</button>
        </div>
        <div id="s_status" class="status-bar">
          <span id="s_currentLabel">—</span>
          <div class="status-progress">
            <div id="s_progressFill"></div>
          </div>
        </div>

        <div class="timeline" id="s_timeline">
          <div class="rail"></div>
          <div id="s_nowDot" class="now-indicator" style="top:-9999px"></div>
          <div id="s_slots"></div>
        </div>
        <div id="s_weekend" class="weekend" style="display:none">
          <h3>🏫 School Closed — No Classes Scheduled</h3>
          <div class="sub">Use ◀ / ▶ to navigate to a weekday.</div>
        </div>
      </section>
    </div>
  </section>

  <!-- ASSIGNMENTS -->
  <section id="page-s-assign" class="page">
    <div class="hero container">
      <div>
        <h2>Assignments Overview</h2>
        <div class="meta" id="assMeta">—</div>
      </div>
      <div class="meta" id="assSummary">—</div>
    </div>
    <div class="container">
      <div class="toolbar">
        <input id="assSearch" class="input" placeholder="Search assignments…"/>
        <select id="assCourse"><option value="">All courses</option></select>
        <select id="assStatus">
          <option value="">All status</option>
          <option value="open">Open</option>
          <option value="doing">Doing</option>
          <option value="done">Done</option>
        </select>
        <button id="assSort" class="btn">Sort by due ↑</button>
        <div style="flex:1"></div>
        <input id="newTitle" class="input" placeholder="New assignment title"/>
        <input id="newDue" type="datetime-local" class="input"/>
        <select id="newCourse" class="input"></select>
        <button id="addAss" class="btn primary">Add</button>
      </div>
      <div id="assList" class="board"></div>
    </div>
  </section>

  <!-- GRADES -->
  <section id="page-s-grades" class="page">
    <div class="hero container">
      <div>
        <h2>Grades</h2>
        <div class="meta">Quarter snapshot & trends</div>
      </div>
    </div>
    <div class="container">
      <div class="gpa">
        <div class="gpa-badge" id="gpaBadge">GPA —</div>
        <div class="gpa-track"><div class="gpa-fill" id="gpaFill"></div></div>
        <div class="gpa-meta" id="gpaMeta">Across 0 courses</div>
      </div>
  <div class="grid3" id="gradesGrid"></div>
  </div>
</section>

  <!-- DIRECTORY -->
  <section id="page-s-directory" class="page">
    <div class="hero container">
      <div>
        <h2>Directory</h2>
        <div class="meta">Search & browse</div>
      </div>
    </div>
    <div class="container">
      <div class="dir-tabs">
        <button id="btnStud" class="btn active" data-kind="students">Students</button>
        <button id="btnTeach" class="btn" data-kind="teachers">Teachers</button>
      </div>
      <div class="dir-tools">
        <input id="dirSearch" class="input" placeholder="Search name, subject, email…"/>
        <select id="dirGrade" class="input">
          <option value="9">Grade 9</option>
          <option value="10" selected>Grade 10</option>
          <option value="11">Grade 11</option>
          <option value="12">Grade 12</option>
        </select>
      </div>
      <div id="dirGrid" class="dir-grid"></div>
      <div class="pager">
        <button id="prevPage" class="btn">Prev</button>
        <span id="pageInfo" class="meta"></span>
        <button id="nextPage" class="btn">Next</button>
      </div>
    </div>
  </section>
</main>

<section id="page-s-pantherbot" class="page">
  <div class="container" style="padding-top: 20px;">
    <div class="hero" style="margin-bottom: 12px;">
      <div>
        <h2>🐾 PantherBot</h2>
        <div class="meta">Your AI-powered handbook assistant</div>
      </div>
      <div>
        <button id="newChatBtn" class="btn" title="Start a new chat">New chat</button>
      </div>
    </div>
    <!-- Removed static chip suggestions (Dress code, Attendance, Phones, etc.) per request -->
    <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message bot">
        👋 Hi, I’m <b>PantherBot</b> — your Portledge assistant. Ask me anything about school rules, dress code, or policies!
      </div>
    </div>
    <div class="chat-input">
      <input type="text" id="userInput" placeholder="Ask about the handbook..." />
      <button id="voiceBtn" title="Voice input" aria-label="Voice input">🎤</button>
      <button id="sendBtn">Send</button>
    </div>
  </div>
  </div>
</section>


<!-- Teacher dashboard removed -->

<!-- ===== Modal (reused by student grades if needed) ===== -->
<div id="gradeModal" class="modal hidden" role="dialog" aria-labelledby="mTitle">
  <div class="modal-content">
    <button id="closeModal" class="close-btn">Close</button>
    <h3 id="mTitle">Course Details</h3>
    <div id="mBody" class="meta">—</div>
  </div>
</div>



<script>

// === Helper Functions (must be first!) ===
const $ = s => document.querySelector(s);
const $$ = s => [...document.querySelectorAll(s)];

// === STATIC WEEKLY SCHEDULE ===
// Each entry: start, end in "HH:MM" 24h format, name, teacher (optional)
// === STATIC WEEKLY SCHEDULE (clean, non-overlapping, 12-hour times) ===
// Rule: “Free Period” only if the gap is >= 30 min. Lunches that overlap a class are removed.
const weeklySchedule = {
  // ===== SCHEDULE TIMING STRUCTURE =====
  // MONDAY: All classes are 40 minutes so students can attend EVERY class in one day
  // TUESDAY-FRIDAY: Most classes are 50 minutes, some are 70 minutes (lab sciences, languages, PE)
  // =====================================
  
  Monday: [
    { start: "8:20 AM", end: "9:00 AM", name: "History 10: Modern European History - 1", teacher: "Robert Liberto — Commons C306" },
    { start: "9:00 AM", end: "9:46 AM", name: "Free Period" },

    { start: "9:46 AM", end: "9:56 AM", name: "Upper School Advisor - 26", teacher: "Jessica Schulteisz — Upper School 1D" },
    { start: "9:59 AM", end: "10:39 AM", name: "Chemistry - 1", teacher: "Roger LaFlair — Upper School 11" },
    { start: "10:42 AM", end: "11:17 AM", name: "Upper School Conference Time - 1", teacher: "Melissa Damm — N/A" },
    { start: "11:17 AM", end: "12:03 PM", name: "Free Period" },

    { start: "12:03 PM", end: "12:43 PM", name: "Advanced English 10 - 1", teacher: "Ruth Ashby — Upper School 7" },
    // Lunch 1 removed (overlapped by Spanish)
    { start: "12:45 PM", end: "1:25 PM", name: "Spanish 3 - 2", teacher: "Eleni Stefanopoulos — Commons C307" },
    { start: "1:25 PM", end: "2:07 PM", name: "Upper School Lunch — Monday 2", teacher: "Robert Liberto — Commons C-DH" },
    { start: "2:07 PM", end: "2:47 PM", name: "Algebra 2 - 2", teacher: "Holliday Harrigan — Upper School 16" },
    { start: "2:50 PM", end: "3:30 PM", name: "Computer Science Principles - 1", teacher: "Danny Nelson — Athletics & Wellness Center 204" },
  ],

  Tuesday: [
    { start: "8:20 AM", end: "9:13 AM", name: "Free Period" },
    { start: "9:13 AM", end: "10:23 AM", name: "Chemistry - 1", teacher: "Roger LaFlair — Upper School 11" },
    { start: "10:26 AM", end: "10:36 AM", name: "Upper School Advisor - 26", teacher: "Jessica Schulteisz — Upper School 1D" },
    { start: "10:39 AM", end: "11:29 AM", name: "Physical Education - 4", teacher: "Joseph Cavallaro — Athletics & Wellness Center FC" },
    { start: "11:31 AM", end: "12:01 PM", name: "Upper School Conference Time - 1", teacher: "Melissa Damm — N/A" },
    // Lunch 1 removed (overlaps English)
    { start: "12:04 PM", end: "12:54 PM", name: "Advanced English 10 - 1", teacher: "Ruth Ashby — Upper School 7" },
    { start: "12:54 PM", end: "1:27 PM", name: "Upper School Lunch — Tuesday 2", teacher: "Robert Liberto — Commons C-DH" },
    { start: "1:27 PM", end: "2:37 PM", name: "Spanish 3 - 2", teacher: "Eleni Stefanopoulos — Commons C307" },
    { start: "2:40 PM", end: "3:30 PM", name: "Algebra 2 - 2", teacher: "Holliday Harrigan — Upper School 16" },
  ],

  // Default: Conference Time (we’ll layer clubs every other week later)
  Wednesday: [
    { start: "8:20 AM", end: "9:10 AM", name: "Computer Science Principles - 1", teacher: "Danny Nelson — Athletics & Wellness Center 204" },
    { start: "9:13 AM", end: "10:23 AM", name: "History 10: Modern European History - 1", teacher: "Robert Liberto — Commons C306" },
    { start: "10:26 AM", end: "10:36 AM", name: "Upper School Advisor - 26", teacher: "Jessica Schulteisz — Upper School 1D" },
    { start: "10:36 AM", end: "11:31 AM", name: "Free Period" },
    { start: "11:31 AM", end: "12:01 PM", name: "Upper School Conference Time - 1", teacher: "Melissa Damm — N/A" },
    { start: "12:01 PM", end: "12:34 PM", name: "Upper School Lunch — Wednesday 1", teacher: "Robert Liberto — Commons C-DH" },
    { start: "12:34 PM", end: "1:24 PM", name: "Chemistry - 1", teacher: "Roger LaFlair — Upper School 11" },
    // Lunch 2 overlaps Chemistry → removed
    { start: "1:27 PM", end: "2:37 PM", name: "Physical Education - 4", teacher: "Joseph Cavallaro — Athletics & Wellness Center FC" },
    { start: "2:40 PM", end: "3:30 PM", name: "Advanced English 10 - 1", teacher: "Ruth Ashby — Upper School 7" },
  ],

  Thursday: [
    { start: "8:20 AM", end: "9:10 AM", name: "Spanish 3 - 2", teacher: "Eleni Stefanopoulos — Commons C307" },
    { start: "9:13 AM", end: "10:23 AM", name: "Algebra 2 - 2", teacher: "Holliday Harrigan — Upper School 16" },
    { start: "10:26 AM", end: "10:36 AM", name: "Upper School Advisor - 26", teacher: "Jessica Schulteisz — Upper School 1D" },
    { start: "10:39 AM", end: "11:29 AM", name: "Computer Science Principles - 1", teacher: "Danny Nelson — Athletics & Wellness Center 204" },
    { start: "11:31 AM", end: "12:01 PM", name: "Upper School Conference Time - 1", teacher: "Melissa Damm — N/A" },
    { start: "12:01 PM", end: "12:34 PM", name: "Upper School Lunch — Thursday 1", teacher: "Robert Liberto — Commons C-DH" },
    { start: "12:34 PM", end: "1:24 PM", name: "History 10: Modern European History - 1", teacher: "Robert Liberto — Commons C306" },
    // Lunch 2 overlaps History → removed
    { start: "1:24 PM", end: "2:40 PM", name: "Free Period" },
    { start: "2:40 PM", end: "3:30 PM", name: "Chemistry - 1", teacher: "Roger LaFlair — Upper School 11" },
  ],

  Friday: [
    { start: "8:20 AM", end: "9:13 AM", name: "Free Period" },
    { start: "9:13 AM", end: "9:43 AM", name: "Town Meeting — Upper School Town Meeting - 1", teacher: "Eden White — Commons C-DH" },
    { start: "9:46 AM", end: "10:56 AM", name: "Advanced English 10 - 1", teacher: "Ruth Ashby — Upper School 7" },
    { start: "10:58 AM", end: "11:08 AM", name: "Upper School Advisor - 26", teacher: "Jessica Schulteisz — Upper School 1D" },
    { start: "11:11 AM", end: "12:01 PM", name: "Spanish 3 - 2", teacher: "Eleni Stefanopoulos — Commons C307" },
    // Lunch 1 (12:01–12:34) overlaps Algebra → removed
    { start: "12:04 PM", end: "12:54 PM", name: "Algebra 2 - 2", teacher: "Holliday Harrigan — Upper School 16" },
    { start: "12:54 PM", end: "1:27 PM", name: "Upper School Lunch — Friday 2", teacher: "Robert Liberto — Commons C-DH" },
    { start: "1:27 PM", end: "2:37 PM", name: "Computer Science Principles - 1", teacher: "Danny Nelson — Athletics & Wellness Center 204" },
    { start: "2:40 PM", end: "3:30 PM", name: "History 10: Modern European History - 1", teacher: "Robert Liberto — Commons C306" },
  ],
};





// === RENDER SCHEDULE (NO ICS, FALLBACK ONLY) ===
// =====================
// STATIC RENDER SCHEDULE
// =====================



let offset = 0;



// ===== Holidays (federal + selected religious) =====
const holidayOverrides = new Map([
   //✨ Add exact one-day or multi-day closures here as needed:
   ["2025-10-02", "Rosh Hashanah"], ["2025-10-03", "Rosh Hashanah"],
   ["2025-10-12", "Yom Kippur"],
   ["2025-10-20", "Diwali"],
]);

function toISODate(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()).toISOString().slice(0,10); }
function isSameDate(a,b){ return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }
function getNthWeekdayOfMonth(year, monthIndex, weekday, n){
  // weekday: 0=Sun...6=Sat, monthIndex: 0=Jan...11=Dec, n: 1..5 or -1 for last
  if(n === -1){
    const lastDay = new Date(year, monthIndex+1, 0);
    const diff = (lastDay.getDay() - weekday + 7) % 7;
    return new Date(year, monthIndex+1, 0 - diff);
  }
  const first = new Date(year, monthIndex, 1);
  const offset = (7 + weekday - first.getDay()) % 7;
  return new Date(year, monthIndex, 1 + offset + 7*(n-1));
}

function getHolidayName(date){
  const y = date.getFullYear();
  const iso = toISODate(date);

  // Manual overrides (religious & district-specific)
  if (holidayOverrides.has(iso)) return holidayOverrides.get(iso);

  // Fixed-date closures
  const fixed = {
    "01-01": "New Year’s Day",
    "06-19": "Juneteenth",
    "07-04": "Independence Day",
    "11-11": "Veterans Day",
  };
  const mmdd = iso.slice(5);
  if (fixed[mmdd]) return fixed[mmdd];

  // Floating federal-style closures common to US public schools
  const mlk = getNthWeekdayOfMonth(y, 0, 1, 3);           // Jan, Mon, 3rd
  const presidents = getNthWeekdayOfMonth(y, 1, 1, 3);    // Feb, Mon, 3rd
  const memorial = getNthWeekdayOfMonth(y, 4, 1, -1);     // May, Mon, last
  const labor = getNthWeekdayOfMonth(y, 8, 1, 1);         // Sep, Mon, 1st
  const indigenous = getNthWeekdayOfMonth(y, 9, 1, 2);    // Oct, Mon, 2nd
  const thanksgivingThu = getNthWeekdayOfMonth(y, 10, 4, 4); // Nov, Thu, 4th
  const thanksgivingFri = new Date(thanksgivingThu); thanksgivingFri.setDate(thanksgivingThu.getDate()+1);

  if (isSameDate(date, mlk)) return "Martin Luther King Jr. Day";
  if (isSameDate(date, presidents)) return "Presidents’ Day";
  if (isSameDate(date, memorial)) return "Memorial Day";
  if (isSameDate(date, labor)) return "Labor Day";
  if (isSameDate(date, indigenous)) return "Indigenous Peoples’ Day";
  if (isSameDate(date, thanksgivingThu)) return "Thanksgiving Day";
  if (isSameDate(date, thanksgivingFri)) return "Thanksgiving Break";

  // Winter Break (typical): Dec 23 – Jan 1 inclusive
  const dec23 = new Date(y, 11, 23), dec31 = new Date(y, 11, 31), jan1 = new Date(y+1, 0, 1);
  if (date >= dec23 && date <= dec31) return "Winter Break";
  if (isSameDate(date, jan1)) return "Winter Break";

  // Religious holidays (set via overrides for exact school-year dates)
  // Add to holidayOverrides as district calendars are published:
  // e.g., holidayOverrides.set("2025-09-22","Rosh Hashanah");

  return null;
}

// === CLUB ROTATION SWITCH ===
// Even weeks = Clubs, Odd weeks = Conference
function getClubWeekFlag(date) {
  // Example rule: Week number of the year (ISO)
  const firstJan = new Date(date.getFullYear(), 0, 1);
  const days = Math.floor((date - firstJan) / 86400000);
  const weekNum = Math.ceil((days + firstJan.getDay() + 1) / 7);
  return weekNum % 2 === 0; // ✅ EVEN weeks = Club Week
}


function renderSchedule() {
  // Use override "now" if set so Temp Settings affects the schedule day/time
  const baseNow = getNow();
  const date = new Date(baseNow);
  date.setDate(date.getDate() + offset);

  const dayName = date.toLocaleDateString("en-US", { weekday: "long" });
  const container = document.getElementById("s_slots");
  const bigDate = document.getElementById("s_bigDate");
  const todayMeta = document.getElementById("s_todayMeta");
  const daySummary = document.getElementById("s_daySummary");
  const weekend = document.getElementById("s_weekend");

  bigDate.textContent = date.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });
  todayMeta.textContent = (offset === 0) ? "Today" : "";
  daySummary.textContent = "";
  container.innerHTML = "";

  let entries = weeklySchedule[dayName] || [];

  // ✅ Detect club/conference status
  const isClubWeek = getClubWeekFlag(date);

  // ✅ Wednesday swap
  if (dayName === "Wednesday" && entries.length > 0) {
    entries = entries.map(entry => {
      if (entry.name.includes("Upper School Conference Time")) {
        return {
          ...entry,
          name: isClubWeek ? "Upper School Clubs" : "Upper School Conference Time - 1",
          teacher: isClubWeek ? "Eden White — N/A" : "Melissa Damm — N/A"
        };
      }
      return entry;
    });
  }

  // ✅ Holiday / Weekend check
  const holiday = getHolidayName(date);
  const isWeekend = (date.getDay() === 0 || date.getDay() === 6);

  if (holiday || isWeekend) {
    weekend.style.display = "block";
    weekend.innerHTML = `<h3>🏫 School Closed — ${holiday || "Weekend"}</h3>`;
    // Hide any progress UI on closed days
    const progWrap = document.querySelector('.day-progress-wrap');
    if(progWrap) progWrap.style.display = 'none';
    const smallStatus = document.getElementById('s_status');
    if(smallStatus) smallStatus.classList.add('hidden');
    return;
  }

  weekend.style.display = "none";
  // Ensure status/progress are visible (JS will toggle detailed percent depending on open hours)
  const smallStatus = document.getElementById('s_status');
  if(smallStatus) smallStatus.classList.remove('hidden');

  // ❗️ If no entries, display fallback
  if (!entries || entries.length === 0) {
    container.innerHTML = `<div class="slot"><div class="slot-inner"><div class="cls">No Schedule Found</div></div></div>`;
    return;
  }

  // For today, use override time; for other days, do not show progress or 'now:'
  let now;
  let showProgress = offset === 0;
  const currentTimeOfDay = getNow(); // Always get current time for mini card
  if(showProgress){
    now = getNow();
  } else {
    now = null;
    // Hide progress bar and status for non-today
    const progWrap = document.querySelector('.day-progress-wrap');
    if(progWrap) progWrap.style.display = 'none';
    const smallStatus = document.getElementById('s_status');
    if(smallStatus) smallStatus.classList.add('hidden');
  }

  let nowAssigned = false;
  const fragment = document.createDocumentFragment(); // Use fragment for batch DOM insert
  
  // ===== PASSING TIME DETECTION =====
  // Detect 3-minute gaps between classes and insert invisible passing time periods
  const enhancedEntries = [];
  for (let i = 0; i < entries.length; i++) {
    enhancedEntries.push(entries[i]);
    
    // Check if there's a next class
    if (i < entries.length - 1) {
      const currentEnd = parseTimeToDate(date, entries[i].end);
      const nextStart = parseTimeToDate(date, entries[i + 1].start);
      const gapMinutes = Math.round((nextStart - currentEnd) / 60000);
      
      // If gap is exactly 3 minutes, insert passing time (invisible card, visible in progress bar)
      if (gapMinutes === 3) {
        enhancedEntries.push({
          name: '🚶 Passing Time',
          start: entries[i].end,
          end: entries[i + 1].start,
          teacher: '',
          isPassingTime: true // Flag for special rendering
        });
      }
    }
  }
  
  enhancedEntries.forEach(event => {
    const slot = document.createElement("div");
    const startD = parseTimeToDate(date, event.start);
    const endD = parseTimeToDate(date, event.end);
    let cls = '';
    if(showProgress && now){
      if (now >= endD) cls = 'done';
      else if (!nowAssigned && now >= startD && now < endD) { cls = 'now'; nowAssigned = true; }
      else if (now < startD) cls = 'up';
    } else {
      // For non-today views, just show timeline state without special free-period styling
      if (offset > 0) cls = 'up';
      else cls = 'done';
    }

    // ===== PASSING TIME: Don't render card, but it exists for progress bar calculation =====
    if (event.isPassingTime) {
      // Create invisible marker element for progress bar calculation only
      slot.className = `slot ${cls} passing-time-marker`;
      slot.style.display = 'none'; // Completely hidden from view
      slot.setAttribute('data-end-time', event.end);
      slot.setAttribute('data-start-time', event.start);
      slot.setAttribute('data-passing-time', 'true');
      fragment.appendChild(slot);
      return; // Don't render visual card
    }

      // No 'Starts in' text; we'll render a mini progress + 'Ends in' only for current period via updater

      slot.className = `slot ${cls}`;
      slot.setAttribute('data-end-time', event.end);
      slot.setAttribute('data-start-time', event.start);
      slot.innerHTML = `
        <div class="dot"></div>
        <div class="slot-inner">
          <div>
            <div class="time">${event.start} - ${event.end}</div>
          </div>
          <div>
            <div class="cls">${event.name}</div>
            <div class="meta">${event.teacher || ""}</div>
          </div>
        </div>
      `;
      fragment.appendChild(slot);
  });
  container.appendChild(fragment); // Single DOM operation instead of multiple
  // update the small progress / now indicator only for today
  if(showProgress && now) updateProgressBar(enhancedEntries, now);

  // Start countdown timer for current class
  if(showProgress) updateCountdowns();

  // Animation removed for performance
}

function updateCountdowns() {
  // Update the global status label and progress bar with 'Ends in' for the active period
  const now = getNow();
  
  // Check if we're on today and not a weekend
  const isToday = (typeof offset === 'number') ? (offset === 0) : true;
  const isWeekend = (now.getDay() === 0 || now.getDay() === 6);
  
  // Hide mini card if not today or if weekend
  const miniCard = document.getElementById('miniCurrent');
  if (!isToday || isWeekend) {
    if (miniCard) miniCard.classList.add('hidden');
    return;
  }

  // Helper to strip trailing section markers like " - 1", " - 2", " - 26"
  function cleanName(name){
    if(!name) return name;
    return name.replace(/\s*-\s*\d+\s*$/, "").trim();
  }

  const slots = document.querySelectorAll('#s_slots .slot');
  const fill = document.getElementById('s_progressFill');
  const label = document.getElementById('s_currentLabel');

  let found = false;
  let currentName = '';
  let endLabel = '';
  let startLabel = '';
  let start = null;
  let end = null;
  let isPassingTime = false;

  for (const slot of slots) {
    const endTime = slot.getAttribute('data-end-time');
    const startTime = slot.getAttribute('data-start-time');
    const isPassing = slot.getAttribute('data-passing-time') === 'true';
    if (!endTime || !startTime) continue;

    const s = parseTimeToDate(now, startTime);
    const e = parseTimeToDate(now, endTime);
    if (now >= s && now < e) {
      found = true;
      start = s; end = e;
      isPassingTime = isPassing;
      startLabel = startTime;
      
      if (isPassing) {
        currentName = '🚶 Passing Time';
      } else {
        const raw = slot.querySelector('.cls')?.textContent || 'Now';
        currentName = cleanName(raw);
      }
      endLabel = endTime;
      break;
    }
  }

  // Update the mini current class card
  const mini = document.getElementById('miniCurrent');
  const mTime = document.getElementById('miniTime');
  const mCls = document.getElementById('miniCls');
  const mMeta = document.getElementById('miniMeta');

  if (found && start && end) {
    const total = end - start;
    const elapsed = now - start;
    const pct = Math.max(0, Math.min(100, Math.round((elapsed / total) * 100)));
    if (fill) fill.style.width = pct + '%';

    const remainingMs = end - now;
    const minutes = Math.max(0, Math.ceil(remainingMs / 60000));
    if (isPassingTime) {
      // Passing time: only reflect on progress bar, keep label empty per spec
      if (label) label.textContent = '';
      // Hide mini card during passing time
      if (mini) mini.classList.add('hidden');
    } else {
      if (label) label.textContent = `${currentName} — ${minutes}m left`;
      // Fill mini card details
      if (mini && mTime && mCls && mMeta) {
        mini.classList.remove('hidden');
        mTime.textContent = `${start.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'})} - ${end.toLocaleTimeString([], {hour:'numeric', minute:'2-digit'})}`;
        mCls.textContent = currentName;
        // Try to get teacher from the slot meta
        const currentSlot = Array.from(slots).find(s=>{
          const sText = s.getAttribute('data-start-time');
          const eText = s.getAttribute('data-end-time');
          return sText===startLabel && eText===endLabel;
        }) || null;
        const metaText = currentSlot?.querySelector('.meta')?.textContent || '';
        mMeta.textContent = metaText;
        // Force mini card to always display 'now' (yellow/orange) styling
        mini.classList.remove('up', 'done');
        mini.classList.add('now');
      }
    }
  } else {
    if (fill) fill.style.width = '0%';
    if (label) label.textContent = '';
    // Hide mini card if nothing active
    const mini = document.getElementById('miniCurrent');
    if (mini) mini.classList.add('hidden');
  }
}

function updateProgressBar(entries, nowArg){
  const now = nowArg || getNow();

  let current = null, currentIdx = -1;
  let isPassingTime = false;
  
  entries.forEach((ev, i) => {
    const startD = parseTimeToDate(now, ev.start);
    const endD = parseTimeToDate(now, ev.end);
    if (now >= startD && now < endD) { 
      current = ev; 
      currentIdx = i;
      isPassingTime = ev.isPassingTime || false;
    }
  });

  const fill = document.getElementById("s_progressFill");
  const label = document.getElementById("s_currentLabel");
  function cleanName(name){
    if(!name) return name;
    return name.replace(/\s*-\s*\d+\s*$/, "").trim();
  }

  if (current) {
    const startD = parseTimeToDate(now, current.start);
    const endD = parseTimeToDate(now, current.end);
    const pct = Math.round(((now - startD) / (endD - startD)) * 100);
    fill.style.width = pct + "%";
    const remainingMs = endD - now;
    const minutes = Math.max(0, Math.ceil(remainingMs / 60000));
    
    if (isPassingTime) {
      // Passing time: keep label empty, progress bar still shows fill
      label.textContent = '';
    } else {
      label.textContent = `${cleanName(current.name)} — ${minutes}m left`;
    }
  } else {
    fill.style.width = "0%";
    label.textContent = '';
  }
}


  function startClockAndProgress(startTime = "08:20", endTime = "15:30") {
    const clockEl = document.getElementById("liveClock");
    const progEl = document.querySelector('.day-progress > i');
    const pctText = document.querySelector('.day-percent');

    function nowFromOverride(){
      const o = localStorage.getItem('pd_time_override');
      if(!o) return new Date();
      const t = new Date(o);
      return isNaN(t.getTime())? new Date(): t;
    }

    function updateClock() {
      const now = nowFromOverride();
      // We no longer show the clock; percent-of-day will be displayed instead next to the progress bar
      if(clockEl) { clockEl.textContent = ''; clockEl.style.display = 'none'; }

      const [sH, sM] = startTime.split(':').map(Number);
      const [eH, eM] = endTime.split(':').map(Number);
      const start = new Date(now.getFullYear(), now.getMonth(), now.getDate(), sH, sM, 0, 0);
      const end = new Date(now.getFullYear(), now.getMonth(), now.getDate(), eH, eM, 0, 0);
      const isOpen = now >= start && now <= end && !weekend(now);
      const isToday = (typeof offset === 'number') ? (offset === 0) : true;
      const wrapper = document.querySelector('.day-progress-wrap');
      if(wrapper) wrapper.style.display = (isOpen && isToday)? 'flex':'none';
      
      // Hide status bar outside school hours
      const statusBar = document.getElementById('s_status');
      if(statusBar) statusBar.style.display = (isOpen && isToday)? 'flex':'none';
      
      if(isOpen && isToday && progEl){
        const percent = Math.round(Math.min(100, Math.max(0, ((now - start) / (end - start)) * 100)));
        progEl.style.width = percent + '%';
        if(pctText) pctText.textContent = percent + '%';
        // keep the global class progress/label fresh during open hours
        try { updateCountdowns(); } catch {}
      } else if(progEl){
        progEl.style.width = '0%'; if(pctText) pctText.textContent = '';
      }
    }

    updateClock();
    setInterval(updateClock, 15000); // Update every 15s for timely show/hide within school hours
  }

/* ===== Helpers ===== */
// $ and $$ already defined at top of script
const fmtHM = new Intl.DateTimeFormat([], {hour:'numeric', minute:'2-digit'});
const fmtFull = new Intl.DateTimeFormat([], {weekday:'long', month:'long', day:'numeric', year:'numeric'});
const fmtClockT = new Intl.DateTimeFormat([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});

// Return effective "now" considering temp override
function getNow(){
  const o = localStorage.getItem('pd_time_override');
  if(!o) return new Date();
  const t = new Date(o);
  return isNaN(t.getTime())? new Date(): t;
}

// Parse a "HH:MM AM/PM" or "HH:MM" into a Date on the provided baseDate
function parseTimeToDate(baseDate, hm){
  // normalize eg "8:20 AM" or "08:20" to a Date matching baseDate
  const str = (hm||'').trim();
  if(!str) return new Date(baseDate);
  // Try Date.parse with a composed string
  const ampm = /am|pm/i.test(str);
  let d;
  if(ampm){
    d = new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate(), 0,0,0,0);
    // use Date.parse for locale-aware parsing
    const tmp = new Date(baseDate.toDateString() + ' ' + str);
    if(!isNaN(tmp.getTime())) return tmp;
  }
  // fallback: split HH:MM and guess 24h
  const m = str.match(/(\d{1,2}):(\d{2})/);
  if(m){
    const hh = Number(m[1]); const mm = Number(m[2]);
    const out = new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate(), hh, mm, 0, 0);
    return out;
  }
  return new Date(baseDate);
}


/* ===== Login Routing ===== */
const ROLE_KEY='pd_role_v11';
const savedRole = localStorage.getItem(ROLE_KEY);
if (savedRole === 'student') {
  route('student');
  initStudent();
  renderSchedule();
  startClockAndProgress("08:20", "15:30");
}

function showSection(id, show=true){ const el=$(id); if(!el) return; el.classList.toggle('hidden', !show); }
function route(role){
  // hide login
  showSection('#login', false);
  if(role==='student'){
    showSection('#top-student', true); showSection('#nav-student', true); showSection('#dashboard-student', true);
    // Ensure student pages render
    const pages=['s-schedule','s-assign','s-grades','s-directory'];
    pages.forEach(id=>{
      const el=document.getElementById('page-'+id);
      if(!el) return;
      const on = (id==='s-schedule');
      el.classList.toggle('active', on);
      el.style.display = on? 'block':'none';
    });
    const tabs=$$('#nav-student .tab');
    tabs.forEach(t=>{ const on=t.dataset.page==='s-schedule'; t.classList.toggle('active',on); t.setAttribute('aria-selected',on); });
  }
}
function signOut(){
  localStorage.removeItem(ROLE_KEY);
  localStorage.removeItem('portledge_saved_email'); // Clear saved email
  location.reload();
}


function handleLogin() {
  const val = ($('#role').value||'').trim();
  const required = 'cmallor.2028@portledge.org';

  if (val === required) {
    localStorage.setItem(ROLE_KEY, 'student');
    localStorage.setItem('portledge_saved_email', val);
    
    route('student');
    initStudent();
    // Prevent any flash of progress/status before school-hours check applies
    try {
      const wrap = document.querySelector('.day-progress-wrap');
      if (wrap) wrap.style.display = 'none';
      const statusBar = document.getElementById('s_status');
      if (statusBar) statusBar.style.display = 'none';
    } catch {}
    // Render schedule, then immediately enforce school-hours visibility
    renderSchedule();  // ✅ Force schedule refresh right after login
    startClockAndProgress("08:20", "15:30"); // ✅ Enforce 8:20–3:30 gating instantly on login
  } else {
    console.warn("Invalid login");
    $('#loginCard').classList.remove('shake');
    void $('#loginCard').offsetWidth;
    $('#loginCard').classList.add('shake');
  }
}

// ===== CUSTOMIZATION SYSTEM =====
const CUSTOMIZATION_KEY = 'portledge_customizations';

function openCustomizeModal() {
  document.getElementById('customizeModal').style.display = 'flex';
  loadCustomizeValues();
}

function closeCustomizeModal() {
  document.getElementById('customizeModal').style.display = 'none';
}

function loadCustomizeValues() {
  const saved = JSON.parse(localStorage.getItem(CUSTOMIZATION_KEY) || '{}');
  
  // Load colors
  document.getElementById('accentColor').value = saved.accentColor || '#667eea';
  document.getElementById('secondaryColor').value = saved.secondaryColor || '#764ba2';
  
  // Load login background
  document.getElementById('loginBg').value = saved.loginBg || 'gradient1';
}

function saveCustomizations() {
  const customizations = {
    accentColor: document.getElementById('accentColor').value,
    secondaryColor: document.getElementById('secondaryColor').value,
    loginBg: document.getElementById('loginBg').value,
  };
  
  localStorage.setItem(CUSTOMIZATION_KEY, JSON.stringify(customizations));
  applyCustomizations(customizations);
  closeCustomizeModal();
  
  // Show success message
  alert('✅ Customizations saved! Refresh to see all changes.');
}

function resetCustomizations() {
  if(confirm('Reset all customizations to default?')){
    localStorage.removeItem(CUSTOMIZATION_KEY);
    loadCustomizeValues();
    applyCustomizations({});
    alert('✅ Reset to defaults!');
  }
}

function loadUserCustomizations() {
  const saved = JSON.parse(localStorage.getItem(CUSTOMIZATION_KEY) || '{}');
  applyCustomizations(saved);
}

function applyCustomizations(custom) {
  const root = document.documentElement;
  
  // Apply color theme
  if(custom.accentColor){
    root.style.setProperty('--accent', custom.accentColor);
  }
  if(custom.secondaryColor){
    root.style.setProperty('--secondary', custom.secondaryColor);
  }
  
  // Apply login background
  const loginBgMap = {
    gradient1: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    gradient2: 'linear-gradient(135deg, #2193b0 0%, #6dd5ed 100%)',
    gradient3: 'linear-gradient(135deg, #f46b45 0%, #eea849 100%)',
    gradient4: 'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)',
    gradient5: 'linear-gradient(135deg, #ff00cc 0%, #333399 100%)'
  };
  
  const loginSection = document.getElementById('login');
  if(loginSection && custom.loginBg){
    loginSection.style.background = loginBgMap[custom.loginBg] || loginBgMap.gradient1;
  }
}

// Attach customize button click
document.addEventListener('DOMContentLoaded', () => {
  const customizeBtn = document.getElementById('customizeLoginBtn');
  if(customizeBtn){
    customizeBtn.addEventListener('click', openCustomizeModal);
  }
  
  // Dashboard customize button
  const customizeDashboardBtn = document.getElementById('customizeDashboardBtn');
  if(customizeDashboardBtn){
    customizeDashboardBtn.addEventListener('click', openCustomizeModal);
  }
});

// ===== Load saved email on page load (auto) =====
window.addEventListener('DOMContentLoaded', () => {
  const savedEmail = localStorage.getItem('portledge_saved_email');
  if (savedEmail) {
    const emailInput = document.getElementById('role');
    if (emailInput) {
      emailInput.value = savedEmail;
    }
  }
  
  // Load user customizations
  loadUserCustomizations();
});


// Attach login button event
document.getElementById("loginBtn").addEventListener("click", handleLogin);

// Allow pressing Enter in the input to trigger login
document.getElementById("role").addEventListener("keydown", e => {
  if (e.key === "Enter") handleLogin();
});

/* ===== STUDENT DASHBOARD LOGIC ===== */
function initStudent(){
  // Tabs
  // Fail-safe: ensure student UI is visible
  showSection('#top-student', true);
  showSection('#nav-student', true);
  showSection('#dashboard-student', true);
  
  // Attach sign out button
  const signOutBtn = document.getElementById('signOutStudent');
  if (signOutBtn && !signOutBtn.__bound) {
    signOutBtn.addEventListener('click', signOut);
    signOutBtn.__bound = true;
  }
  
  // Hook up with animated transitions
  const animateDaySwitch = (dir, changeFn) => {
    const tl = document.getElementById('s_timeline');
    const outClass = dir==='next' ? 'anim-out-left' : dir==='prev' ? 'anim-out-right' : 'anim-out-fade';
    const inClass  = dir==='next' ? 'anim-in-right'  : dir==='prev' ? 'anim-in-left'  : 'anim-in-fade';
    if (tl){
      tl.classList.remove(outClass, inClass);
      void tl.offsetWidth;
      tl.classList.add(outClass);
      setTimeout(()=>{
        tl.classList.remove(outClass);
        changeFn();
        renderSchedule();
        tl.classList.add(inClass);
        setTimeout(()=> tl.classList.remove(inClass), 220);
      }, 180);
    } else {
      changeFn();
      renderSchedule();
    }
  };

  document.getElementById('s_prev').onclick = () => animateDaySwitch('prev', ()=>{ offset--; });
  document.getElementById('s_next').onclick = () => animateDaySwitch('next', ()=>{ offset++; });
  document.getElementById('s_today').onclick = () => animateDaySwitch('today', ()=>{ offset = 0; });
}


  $$('#nav-student .tab').forEach(t=> t.addEventListener('click', ()=>{
    const id=t.dataset.page;
    $$('#nav-student .tab').forEach(x=>{const on=x===t; x.classList.toggle('active',on); x.setAttribute('aria-selected',on);});
    $$('#dashboard-student .page').forEach(p=> {
      const on = p.id===`page-${id}`;
      p.classList.toggle('active', on);
      // hard fallback to ensure visibility
      p.style.display = on? 'block':'none';
    });
  }));

  // Demo data — student schedule

  
  function asDate(hm,off){const[dH,dM]=hm.split(':').map(Number); const d=new Date(); d.setDate(d.getDate()+off); d.setHours(dH,dM,0,0); return d;}
function weekend(d){const n=d.getDay(); return n===0||n===6;}

// Return a weekday-specific base schedule so changing days updates content



  // Student tabs wires
  $$('#nav-student .tab').forEach(btn=>{
    btn.addEventListener('click',()=> window.scrollTo({top:0,behavior:'smooth'}));
  });

  // Student day nav (use arrows in header? For prototype, arrow keys)
  // Day Navigation Buttons (with animation)
  if (!window.__pdDayNavBound){
    window.__pdDayNavBound = true;
    const animateDaySwitch = (dir, changeFn) => {
      const tl = document.getElementById('s_timeline');
      const outClass = dir==='next' ? 'anim-out-left' : dir==='prev' ? 'anim-out-right' : 'anim-out-fade';
      const inClass  = dir==='next' ? 'anim-in-right'  : dir==='prev' ? 'anim-in-left'  : 'anim-in-fade';
      if (tl){
        tl.classList.remove(outClass, inClass);
        void tl.offsetWidth;
        tl.classList.add(outClass);
        setTimeout(()=>{
          tl.classList.remove(outClass);
          changeFn();
          renderSchedule();
          tl.classList.add(inClass);
          setTimeout(()=> tl.classList.remove(inClass), 220);
        }, 180);
      } else {
        changeFn();
        renderSchedule();
      }
    };

    document.getElementById("s_prev").onclick = () => animateDaySwitch('prev', ()=>{ offset--; });
    document.getElementById("s_next").onclick = () => animateDaySwitch('next', ()=>{ offset++; });
    document.getElementById("s_today").onclick = () => animateDaySwitch('today', ()=>{ offset = 0; });
  }


  // Assignments
  const courses=['Algebra II','Chemistry','English','European History','Spanish 3','PE','Advisor'];
  const ASS_KEY='pd_assignments_v11';
  let assignments = loadAssignments();
  function loadAssignments(){
    const seed=[
      {id:1,title:'English — Essay Draft',due:Date.now()+3*864e5,course:'English',status:'open'},
      {id:2,title:'Algebra II — Problem Set 5',due:Date.now()+864e5,course:'Algebra II',status:'doing'},
      {id:3,title:'Chemistry — Lab Report',due:Date.now()+2*864e5,course:'Chemistry',status:'open'},
    ];
    try{const s=JSON.parse(localStorage.getItem(ASS_KEY)||'[]'); return Array.isArray(s)&&s.length?s:seed;}catch{ return seed; }
  }
  function saveAssignments(){ localStorage.setItem(ASS_KEY, JSON.stringify(assignments)); }
  function fillCourseSelectors(){
    $('#assCourse').innerHTML='<option value="">All courses</option>'+courses.map(c=>`<option>${c}</option>`).join('');
    $('#newCourse').innerHTML=courses.map(c=>`<option>${c}</option>`).join('');
  }


  fillCourseSelectors();

  let sortAsc=true;
  function renderAssignments(){
    const q=$('#assSearch').value.toLowerCase().trim();
    const course=$('#assCourse').value; const status=$('#assStatus').value;
    let list=assignments.slice().filter(a=>(!q||a.title.toLowerCase().includes(q))&&(!course||a.course===course)&&(!status||a.status===status));
    const done=assignments.filter(a=>a.status==='done').length;
    $('#assMeta').textContent=`${list.length} shown`;
    $('#assSummary').textContent=`${assignments.length} total • ${done} done (${Math.round(done/Math.max(1,assignments.length)*100)}%)`;

    $('#assList').innerHTML=list.map(a=>`
      <div class="card">
        <div>
          <div class="h">${a.title}</div>
          <div class="sub">${a.course} • Due ${new Date(a.due).toLocaleString()}</div>
        </div>
        <div><span class="tag ${a.status}">${a.status[0].toUpperCase()+a.status.slice(1)}</span></div>
        <div>
          <select class="input ass-status" data-id="${a.id}">
            <option value="open" ${a.status==='open'?'selected':''}>Open</option>
            <option value="doing" ${a.status==='doing'?'selected':''}>Doing</option>
            <option value="done" ${a.status==='done'?'selected':''}>Done</option>
          </select>
        </div>
        <div><button class="btn" data-del="${a.id}">Delete</button></div>
      </div>`).join('');

    $$('.ass-status').forEach(s=> s.onchange=e=>{
      const id=+e.target.dataset.id;
      assignments=assignments.map(x=>x.id===id?{...x,status:e.target.value}:x);
      saveAssignments(); renderAssignments();
    });
    $$('button[data-del]').forEach(b=> b.onclick=e=>{
      const id=+e.target.dataset.del; assignments=assignments.filter(x=>x.id!==id);
      saveAssignments(); renderAssignments();
    });
  }
  renderAssignments();
  $('#assSearch').oninput=renderAssignments; $('#assCourse').onchange=renderAssignments; $('#assStatus').onchange=renderAssignments;
  $('#assSort').onclick=()=>{assignments.sort((a,b)=>sortAsc?(a.due-b.due):(b.due-a.due)); sortAsc=!sortAsc; $('#assSort').textContent=`Sort by due ${sortAsc?'↑':'↓'}`; saveAssignments(); renderAssignments();};
  $('#addAss').onclick=()=>{
    const t=$('#newTitle').value.trim(), d=$('#newDue').value, c=$('#newCourse').value;
    if(!t||!d||!c) return alert('Enter title, due date/time, and course');
    const id=Math.max(0,...assignments.map(a=>a.id))+1;
    assignments.push({id,title:t,due:+new Date(d),course:c,status:'open'});
    saveAssignments(); $('#newTitle').value=''; $('#newDue').value=''; renderAssignments();
  };

  // Grades (student)
  const grades=[
    {course:'Algebra II', grade:92, letter:'A-', details:['Quiz Avg: 90%','HW Avg: 94%','Test 1: 88%','Project: 95%']},
    {course:'European History', grade:88, letter:'B+', details:['Essay 1: 86%','Map Quiz: 92%','Presentation: 85%']},
    {course:'Chemistry', grade:90, letter:'A-', details:['Lab Avg: 93%','Quiz Avg: 88%','Test 1: 89%']},
    {course:'English', grade:93, letter:'A', details:['Essay Avg: 92%','Reading Checks: 95%']},
    {course:'Spanish 3', grade:91, letter:'A-', details:['Vocab Quizzes: 94%','Oral: 88%']},
  ];
  function letterGrad(letter){
    if(letter.startsWith('A')) return 'linear-gradient(90deg,#24b277,#1fa86a)';
    if(letter.startsWith('B')) return 'linear-gradient(90deg,#2b6ccf,#6aa3ff)';
    if(letter.startsWith('C')) return 'linear-gradient(90deg,#efb400,#ffd35a)';
    return 'linear-gradient(90deg,#cc3d3d,#ff7878)';
  }
  function toGpa(p){ if(p>=93)return 4; if(p>=90)return 3.7; if(p>=87)return 3.3; if(p>=83)return 3; if(p>=80)return 2.7; if(p>=77)return 2.3; if(p>=73)return 2; if(p>=70)return 1.7; if(p>=67)return 1.3; if(p>=65)return 1; return 0;}
  function renderGrades(){
    const avgPct=Math.round(grades.reduce((s,g)=>s+g.grade,0)/grades.length);
    const avgGPA=(grades.reduce((s,g)=>s+toGpa(g.grade),0)/grades.length).toFixed(2);
    $('#gpaBadge').textContent=`GPA ${avgGPA}`;
    $('#gpaFill').style.width=`${avgPct}%`;
    $('#gpaMeta').textContent=`Average ${avgPct}% across ${grades.length} courses`;
    $('#gradesGrid').innerHTML=grades.map((g,i)=>`
      <div class="gcard">
        <div class="gheader">
          <h3 class="gtitle">${g.course}</h3>
          <div class="ggrade">${g.letter} • ${g.grade}%</div>
        </div>
        <div class="bar-wrap"><div class="bar" id="bar-${i}" style="background:${letterGrad(g.letter)}"></div></div>
        <div class="gsub">Recent: ${g.details.slice(0,2).join(' • ')}</div>
        <button class="gbtn" data-course="${g.course}">View details</button>
      </div>`).join('');
    grades.forEach((g,i)=> { const el = $('#bar-'+i); if(el) el.style.width=`${g.grade}%`; });
    $$('.gbtn').forEach(btn=> btn.onclick=()=>{
      $('#mTitle').textContent=`${btn.dataset.course} — Details`;
      $('#mBody').innerHTML=`<div><b>Current:</b> ${grades.find(x=>x.course===btn.dataset.course).grade}%</div>`;
      openModal();
    });
  }
  renderGrades();

  // Directory (student)
  setTimeout(() => {
  initDirectory('#dirSearch', '#dirGrid', '#pageInfo', '#prevPage', '#nextPage', '#dirGrade');
}, 50);



/* ===== TEACHER DASHBOARD LOGIC ===== */

/* ===== Directory (shared impl) ===== */
const teachers=[
  {name:'Roger LaFlair', subject:'Chemistry', email:'rlaflair@portledge.org'},
  {name:'Jessica Schulteisz', subject:'Advisor', email:'jschulteisz@portledge.org'},
  {name:'Joseph Cavallaro', subject:'Physical Education', email:'jcavallaro@portledge.org'},
  {name:'Melissa Damm', subject:'Conference Time', email:'mdamm@portledge.org'},
  {name:'Robert Liberto', subject:'Lunch/Commons', email:'rliberto@portledge.org'},
  {name:'Ruth Ashby', subject:'English', email:'rashby@portledge.org'},
  {name:'Eleni Stefanopoulos', subject:'Spanish 3', email:'estefanopoulos@portledge.org'},
  {name:'Holliday Harrigan', subject:'Algebra II', email:'hharrigan@portledge.org'},
];
const studentsAll = [
  {name:"Humairah Ajibade-Taofeeq", gradeLevel:10, email:"hajibadetaofeeq.2028@portledge.org"},
  {name:"Parker Austin", gradeLevel:10, email:"PAustin.2028@portledge.org"},
  {name:"Amelie Baghdassarian", gradeLevel:10, email:"abaghdassarian.2028@portledge.org"},
  {name:"Hope Barnett", gradeLevel:10, email:"HBarnett.2028@portledge.org"},
  {name:"Ted Bei", gradeLevel:10, email:"ybei.2028@portledge.org"},
  {name:"Alexis Bernard", gradeLevel:10, email:"ABernard.2028@portledge.org"},
  {name:"Blake Berntsson", gradeLevel:10, email:"bberntsson.2028@portledge.org"},
  {name:"Belinda Beyer", gradeLevel:10, email:"bbeyer.2028@portledge.org"},
  {name:"Clare Byers", gradeLevel:10, email:"cbyers.2028@portledge.org"},
  {name:"Jacob Carlin", gradeLevel:10, email:"jcarlin.2028@portledge.org"},
  {name:"Frankie Coyne", gradeLevel:10, email:"fcoyne.2028@portledge.org"},
  {name:"Olivia Douyon", gradeLevel:10, email:"ODouyon.2028@portledge.org"},
  {name:"Nick Einzig", gradeLevel:10, email:"neinzig.2028@portledge.org"},
  {name:"Gunnar Franson", gradeLevel:10, email:"GFranson.2028@portledge.org"},
  {name:"Grace Gao", gradeLevel:10, email:"RGao.2028@portledge.org"},
  {name:"Andy Gao", gradeLevel:10, email:"YGao.2028@portledge.org"},
  {name:"Ava Gross", gradeLevel:10, email:"agross.2028@portledge.org"},
  {name:"Josie Hansen", gradeLevel:10, email:"JHansen.2028@portledge.org"},
  {name:"Robert Hare", gradeLevel:10, email:"rhare.2028@portledge.org"},
  {name:"Rifka Carlota Hart", gradeLevel:10, email:"rhart.2028@portledge.org"},
  {name:"Dylan Hatami", gradeLevel:10, email:"dhatami.2028@portledge.org"},
  {name:"Elijah Hewlett", gradeLevel:10, email:"ehewlett.2028@portledge.org"},
  {name:"Jax Horlick", gradeLevel:10, email:"jhorlick.2028@portledge.org"},
  {name:"Chase Hsu", gradeLevel:10, email:"chsu.2028@portledge.org"},
  {name:"McKayla Jelloe", gradeLevel:10, email:"mjelloe.2028@portledge.org"},
  {name:"Lily Rae Kern", gradeLevel:10, email:"lkern.2028@portledge.org"},
  {name:"Alex Klonsky", gradeLevel:10, email:"aklonsky.2028@portledge.org"},
  {name:"Ruby Krainman", gradeLevel:10, email:"rkrainman.2028@portledge.org"},
  {name:"Gianna Lazarus", gradeLevel:10, email:"glazarus.2028@portledge.org"},
  {name:"Andi Lefkowitz", gradeLevel:10, email:"alefkowitz.2028@portledge.org"},
  {name:"Eliza Li", gradeLevel:10, email:"eli.2028@portledge.org"},
  {name:"Alex Liang", gradeLevel:10, email:"cliang.2028@portledge.org"},
  {name:"Haoran Liu", gradeLevel:10, email:"hliu.2028@portledge.org"},
  {name:"Sofia Malatos", gradeLevel:10, email:"smalatos.2028@portledge.org"},
  {name:"Iliana Malevitis", gradeLevel:10, email:"imalevitis.2028@portledge.org"},
  {name:"Mustafa Malik", gradeLevel:10, email:"mmalik.2028@portledge.org"},
  {name:"Chase Rubin Mallor", gradeLevel:10, email:"cmallor.2028@portledge.org"},
  {name:"Julie McCabe", gradeLevel:10, email:"jmccabe.2028@portledge.org"},
  {name:"Justin Meirowitz", gradeLevel:10, email:"jmeirowitz.2028@portledge.org"},
  {name:"Mila Misk", gradeLevel:10, email:"MMisk.2028@portledge.org"},
  {name:"Makayla Montero", gradeLevel:10, email:"mmontero.2028@portledge.org"},
  {name:"Isa Murthy", gradeLevel:10, email:"imurthy.2028@portledge.org"},
  {name:"Sam Okoronkwo", gradeLevel:10, email:"SOkoronkwo.2028@portledge.org"},
  {name:"Liam O'Sullivan", gradeLevel:10, email:"losullivan.2028@portledge.org"},
  {name:"Brielle Palagonia", gradeLevel:10, email:"BPalagonia.2028@portledge.org"},
  {name:"Theo Pasztor", gradeLevel:10, email:"tpasztor.2028@portledge.org"},
  {name:"Trinity Pata", gradeLevel:10, email:"TPata.2028@portledge.org"},
  {name:"Olivia Potter", gradeLevel:10, email:"OPotter.2028@portledge.org"},
  {name:"Eleni Pritsinevelos", gradeLevel:10, email:"epritsinevelos.2028@portledge.org"},
  {name:"Carson Reynolds", gradeLevel:10, email:"creynolds.2028@portledge.org"},
  {name:"Paulina Rucz", gradeLevel:10, email:"prucz.2028@portledge.org"},
  {name:"Micah Sass", gradeLevel:10, email:"MSass.2028@portledge.org"},
  {name:"Lillian Scarpa", gradeLevel:10, email:"lscarpa.2028@portledge.org"},
  {name:"Callie Shao", gradeLevel:10, email:"cshao.2028@portledge.org"},
  {name:"Max Sigler", gradeLevel:10, email:"msigler.2028@portledge.org"},
  {name:"Elijah Silva", gradeLevel:10, email:"ESilva.2028@portledge.org"},
  {name:"Shiloh Simeon", gradeLevel:10, email:"ssimeon.2028@portledge.org"},
  {name:"Milo Strauss", gradeLevel:10, email:"mstrauss.2028@portledge.org"},
  {name:"Josie Trust", gradeLevel:10, email:"jtrust.2028@portledge.org"},
  {name:"David Vaynman", gradeLevel:10, email:"dvaynman.2028@portledge.org"},
  {name:"Patrick Xu", gradeLevel:10, email:"pxu.2028@portledge.org"},
  {name:"Homer Yin", gradeLevel:10, email:"hyin.2028@portledge.org"},
  {name:"Charlie Alessio", gradeLevel:9, email:"calessio.2029@portledge.org"},
  {name:"Aryan Aman", gradeLevel:9, email:"AAman.2029@portledge.org"},
  {name:"Morgan Anderson", gradeLevel:9, email:"manderson.2029@portledge.org"},
  {name:"Stefanos Balanos", gradeLevel:9, email:"sbalanos.2029@portledge.org"},
  {name:"Malia Barnwell", gradeLevel:9, email:"MBarnwell.2029@portledge.org"},
  {name:"Patrick Baynon", gradeLevel:9, email:"pbaynon.2029@portledge.org"},
  {name:"Roxie Benoit", gradeLevel:9, email:"rbenoit.2029@portledge.org"},
  {name:"Emma Bonilla", gradeLevel:9, email:"ebonilla.2029@portledge.org"},
  {name:"Luke Brandt", gradeLevel:9, email:"lbrandt.2029@portledge.org"},
  {name:"Thomas Brown", gradeLevel:9, email:"tbrown.2029@portledge.org"},
  {name:"Cleo Bures", gradeLevel:9, email:"cbures.2029@portledge.org"},
  {name:"Summer Burke", gradeLevel:9, email:"SBurke.2029@portledge.org"},
  {name:"Ava Burton", gradeLevel:9, email:"aburton.2029@portledge.org"},
  {name:"Alexandria Callen", gradeLevel:9, email:"acallen.2029@portledge.org"},
  {name:"Gianna Calonita", gradeLevel:9, email:"gcalonita.2029@portledge.org"},
  {name:"Angelina Chen", gradeLevel:9, email:"achen.2029@portledge.org"},
  {name:"Nikki Chen", gradeLevel:9, email:"nchen.2029@portledge.org"},
  {name:"Tripp Cirelli", gradeLevel:9, email:"acirelli.2029@portledge.org"},
  {name:"Siena Mia Clift", gradeLevel:9, email:"sclift.2029@portledge.org"},
  {name:"Isla Daher", gradeLevel:9, email:"idaher.2029@portledge.org"},
  {name:"Lyric DeJesu", gradeLevel:9, email:"ldejesu.2029@portledge.org"},
  {name:"Sabiha Dinani", gradeLevel:9, email:"sdinani.2029@portledge.org"},
  {name:"Savi Douglas", gradeLevel:9, email:"SDouglas.2029@portledge.org"},
  {name:"Farrah Eisbruck", gradeLevel:9, email:"feisbruck.2029@portledge.org"},
  {name:"Valerie Eusebi", gradeLevel:9, email:"veusebi.2029@portledge.org"},
  {name:"Christian Fanfair", gradeLevel:9, email:"cfanfair.2029@portledge.org"},
  {name:"Robbie Fenn", gradeLevel:9, email:"rfenn.2029@portledge.org"},
  {name:"Maddie Ferruggia", gradeLevel:9, email:"Mferruggia.2029@portledge.org"},
  {name:"Blake Friedman", gradeLevel:9, email:"BFriedman.2029@portledge.org"},
  {name:"Kenzie Gottlieb", gradeLevel:9, email:"mgottlieb.2029@portledge.org"},
  {name:"James Grady", gradeLevel:9, email:"jgrady.2029@portledge.org"},
  {name:"Max Gutow", gradeLevel:9, email:"mgutow.2029@portledge.org"},
  {name:"Riley Hall", gradeLevel:9, email:"rhall.2029@portledge.org"},
  {name:"Daisy Holt", gradeLevel:9, email:"Dholt.2029@portledge.org"},
  {name:"Ali Khalfan", gradeLevel:9, email:"AKhalfan.2029@portledge.org"},
  {name:"Charlotte Kraus", gradeLevel:9, email:"ckraus.2029@portledge.org"},
  {name:"Michael LaPollo", gradeLevel:9, email:"mlapollo.2029@portledge.org"},
  {name:"Logan Lee", gradeLevel:9, email:"LLee.2029@portledge.org"},
  {name:"Connor Long", gradeLevel:9, email:"CLong.2029@portledge.org"},
  {name:"Calder Lyon", gradeLevel:9, email:"clyon.2029@portledge.org"},
  {name:"Danny Mahnken", gradeLevel:9, email:"dmahnken.2029@portledge.org"},
  {name:"Chase Mahoney", gradeLevel:9, email:"cmahoney.2029@portledge.org"},
  {name:"Yanni Malafis", gradeLevel:9, email:"imalafis.2029@portledge.org"},
  {name:"Christina Malevitis", gradeLevel:9, email:"CMalevitis.2029@portledge.org"},
  {name:"Chantal Marcos", gradeLevel:9, email:"Cmarcos.2029@portledge.org"},
  {name:"Hayley Mohammed", gradeLevel:9, email:"hmohammed.2029@portledge.org"},
  {name:"Alexa O'Keefe", gradeLevel:9, email:"aokeefe.2029@portledge.org"},
  {name:"Alexa Olvet", gradeLevel:9, email:"aolvet.2029@portledge.org"},
  {name:"Charlotte Parker", gradeLevel:9, email:"cparker.2029@portledge.org"},
  {name:"Madison Perez", gradeLevel:9, email:"mperez.2029@portledge.org"},
  {name:"Demetri Pritsinevelos", gradeLevel:9, email:"dpritsinevelos.2029@portledge.org"},
  {name:"Ethan Qin", gradeLevel:9, email:"eqin.2029@portledge.org"},
  {name:"Henry Raddock", gradeLevel:9, email:"hraddock.2029@portledge.org"},
  {name:"Logan Rodabaugh", gradeLevel:9, email:"lrodabaugh.2029@portledge.org"},
  {name:"Renita Rose", gradeLevel:9, email:"rrose.2029@portledge.org"},
  {name:"Kaitlyn Rosen", gradeLevel:9, email:"KRosen.2029@portledge.org"},
  {name:"Vivienne Shields", gradeLevel:9, email:"vshields.2029@portledge.org"},
  {name:"Qsang Shim", gradeLevel:9, email:"qshim.2029@portledge.org"},
  {name:"Ashton Spence", gradeLevel:9, email:"aspence.2029@portledge.org"},
  {name:"Liana Stephens", gradeLevel:9, email:"lstephens.2029@portledge.org"},
  {name:"Rowan Subbaiah", gradeLevel:9, email:"rsubbaiah.2029@portledge.org"},
  {name:"Rafael Sukhov", gradeLevel:9, email:"RSukhov.2029@portledge.org"},
  {name:"Brad Tomasheski", gradeLevel:9, email:"btomasheski.2029@portledge.org"},
  {name:"Ariel Tripp", gradeLevel:9, email:"atripp.2029@portledge.org"},
  {name:"Kennedy Tu", gradeLevel:9, email:"ktu.2029@portledge.org"},
  {name:"Jayden Tully", gradeLevel:9, email:"jtully.2029@portledge.org"},
  {name:"Adrian Vasilko", gradeLevel:9, email:"avasilko.2029@portledge.org"},
  {name:"Nataly Wang", gradeLevel:9, email:"zwang.2029@portledge.org"},
  {name:"William Weidinger", gradeLevel:9, email:"wweidinger.2029@portledge.org"},
  {name:"Danica White", gradeLevel:9, email:"DWhite.2029@portledge.org"},
  {name:"Isabel Xu", gradeLevel:9, email:"ixu.2029@portledge.org"},
  {name:"Luca Yieh", gradeLevel:9, email:"eyieh.2029@portledge.org"},
  {name:"Naseer Zahran", gradeLevel:9, email:"NZahran.2029@portledge.org"},
  {name:"Lilianna Ziegler", gradeLevel:9, email:"lziegler.2029@portledge.org"},
  {name:"Marina Zografos", gradeLevel:9, email:"mzografos.2029@portledge.org"},
  // Grade 11 (Class of '27)
  {name:"Stephanie Ahee", gradeLevel:11, email:"SAhee.2027@portledge.org"},
  {name:"Alex Alessio", gradeLevel:11, email:"aalessio.2027@portledge.org"},
  {name:"Jack Austin", gradeLevel:11, email:"JAustin.2027@portledge.org"},
  {name:"Ethan Benun", gradeLevel:11, email:"ebenun.2027@portledge.org"},
  {name:"Asa Bergman", gradeLevel:11, email:"abergman.2027@portledge.org"},
  {name:"Nathalia Bettencourt", gradeLevel:11, email:"NBettencourt.2027@portledge.org"},
  {name:"Keren Blumenfeld", gradeLevel:11, email:"kblumenfeld.2027@portledge.org"},
  {name:"KK Bodian", gradeLevel:11, email:"kbodian.2027@portledge.org"},
  {name:"Maddy Buhr", gradeLevel:11, email:"mbuhr.2027@portledge.org"},
  {name:"Grace Butler", gradeLevel:11, email:"gbutler.2027@portledge.org"},
  {name:"Morgan Butler", gradeLevel:11, email:"mbutler.2027@portledge.org"},
  {name:"Soleil Can", gradeLevel:11, email:"scan.2027@portledge.org"},
  {name:"Charles Chen", gradeLevel:11, email:"pchen.2027@portledge.org"},
  {name:"Drew Cohen", gradeLevel:11, email:"dcohen.2027@portledge.org"},
  {name:"Jordan Cooper", gradeLevel:11, email:"jcooper.2027@portledge.org"},
  {name:"Henry Crofton", gradeLevel:11, email:"hcrofton.2027@portledge.org"},
  {name:"Noah Daher", gradeLevel:11, email:"ndaher.2027@portledge.org"},
  {name:"Thomas Dai", gradeLevel:11, email:"hdai.2027@portledge.org"},
  {name:"Everleigh Daniels", gradeLevel:11, email:"EDaniels.2027@portledge.org"},
  {name:"George Day", gradeLevel:11, email:"gday.2027@portledge.org"},
  {name:"Tommy Dolan", gradeLevel:11, email:"TDolan.2027@portledge.org"},
  {name:"Escher Doshi", gradeLevel:11, email:"edoshi.2027@portledge.org"},
  {name:"Aidan Drummond", gradeLevel:11, email:"ADrummond.2027@portledge.org"},
  {name:"Remi Elberg", gradeLevel:11, email:"relberg.2027@portledge.org"},
  {name:"Bodhi Feldstein", gradeLevel:11, email:"BFeldstein.2027@portledge.org"},
  {name:"Alexis Ferrillo", gradeLevel:11, email:"aferrillo.2027@portledge.org"},
  {name:"Matthew Ferrillo", gradeLevel:11, email:"mferrillo.2027@portledge.org"},
  {name:"Jack Gianatasio", gradeLevel:11, email:"jgianatasio.2027@portledge.org"},
  {name:"Sebastian Halberg", gradeLevel:11, email:"shalberg.2027@portledge.org"},
  {name:"Eliana Herskovitz", gradeLevel:11, email:"eherskovitz.2027@portledge.org"},
  {name:"Ruby Holt", gradeLevel:11, email:"Rholt.2027@portledge.org"},
  {name:"Alice Huangfu", gradeLevel:11, email:"xhuangfu.2027@portledge.org"},
  {name:"Hugo Hyatt", gradeLevel:11, email:"hhyatt.2027@portledge.org"},
  {name:"Elizabeth Kyung", gradeLevel:11, email:"ekyung.2027@portledge.org"},
  {name:"Michael Leandrou", gradeLevel:11, email:"MLeandrou.2027@portledge.org"},
  {name:"Joshua Lee", gradeLevel:11, email:"JLee.2027@portledge.org"},
  {name:"Penelope Leonard", gradeLevel:11, email:"PLeonard.2027@portledge.org"},
  {name:"Isabell Li", gradeLevel:11, email:"jli.2027@portledge.org"},
  {name:"Gabe Littman", gradeLevel:11, email:"GLittman.2027@portledge.org"},
  {name:"Valentina Lopez", gradeLevel:11, email:"vlopez.2027@portledge.org"},
  {name:"Sena Manzone", gradeLevel:11, email:"smanzone.2027@portledge.org"},
  {name:"Addy Martin", gradeLevel:11, email:"amartin.2027@portledge.org"},
  {name:"Liam McCarthy", gradeLevel:11, email:"lmccarthy.2027@portledge.org"},
  {name:"Eddie Mercier", gradeLevel:11, email:"emercier.2027@portledge.org"},
  {name:"Dylan Michalik", gradeLevel:11, email:"dmichalik.2027@portledge.org"},
  {name:"Salma Munoz", gradeLevel:11, email:"smunoz.2027@portledge.org"},
  {name:"Aidan O'Rourke", gradeLevel:11, email:"AOrourke.2027@portledge.org"},
  {name:"Sam Palagonia", gradeLevel:11, email:"SPalagonia.2027@portledge.org"},
  {name:"Juliet Palatnik", gradeLevel:11, email:"jpalatnik.2027@portledge.org"},
  {name:"Jack Pata", gradeLevel:11, email:"JPata.2027@portledge.org"},
  {name:"Jamie Plunkett", gradeLevel:11, email:"jplunkett.2027@portledge.org"},
  {name:"Sebastian Reale", gradeLevel:11, email:"sreale.2027@portledge.org"},
  {name:"Maddie Rhoads", gradeLevel:11, email:"mrhoads.2027@portledge.org"},
  {name:"Abigail Rigg", gradeLevel:11, email:"ARigg.2027@portledge.org"},
  {name:"Simone Sadowski", gradeLevel:11, email:"SSadowski.2027@portledge.org"},
  {name:"Mark Sandys", gradeLevel:11, email:"msandys.2027@portledge.org"},
  {name:"Jaron Schachner", gradeLevel:11, email:"jschachner.2027@portledge.org"},
  {name:"Finn Scott", gradeLevel:11, email:"FScott.2027@portledge.org"},
  {name:"Guanlin Sheng", gradeLevel:11, email:"gsheng.2027@portledge.org"},
  {name:"Raj Singh", gradeLevel:11, email:"rsingh.2027@portledge.org"},
  {name:"Aarosh Srivastava", gradeLevel:11, email:"ASrivastava.2027@portledge.org"},
  {name:"Zach Stennett", gradeLevel:11, email:"zstennett.2027@portledge.org"},
  {name:"Brendan Sweeney", gradeLevel:11, email:"bsweeney.2027@portledge.org"},
  {name:"Remy Terranova", gradeLevel:11, email:"RTerranova.2027@portledge.org"},
  {name:"Madi Todd", gradeLevel:11, email:"mtodd.2027@portledge.org"},
  {name:"Sami Todd", gradeLevel:11, email:"stodd.2027@portledge.org"},
  {name:"John Tsamblakos", gradeLevel:11, email:"JTsamblakos.2027@portledge.org"},
  {name:"Helen Uffelman", gradeLevel:11, email:"huffelman.2027@portledge.org"},
  {name:"Ava Vetrano", gradeLevel:11, email:"avetrano.2027@portledge.org"},
  {name:"Lachlan Vogel", gradeLevel:11, email:"lvogel.2027@portledge.org"},
  {name:"Josiah Warfield", gradeLevel:11, email:"JWarfield.2027@portledge.org"},
  {name:"Emily Wu", gradeLevel:11, email:"ywu.2027@portledge.org"},
  {name:"Sloane Wyttenbach", gradeLevel:11, email:"swyttenbach.2027@portledge.org"},
  {name:"Caden Yang", gradeLevel:11, email:"CYang.2027@portledge.org"},
  {name:"Charlie Yang", gradeLevel:11, email:"xyang.2027@portledge.org"},
  {name:"Jessica Zhao", gradeLevel:11, email:"ZZhao.2027@portledge.org"},
  {name:"Sara Zimmerman", gradeLevel:11, email:"szimmerman.2027@portledge.org"},
  // Grade 12 (Class of '26)
  {name:"Kennedy Abrahams", gradeLevel:12, email:"kabrahams.2026@portledge.org"},
  {name:"Ryder Alstodt", gradeLevel:12, email:"ralstodt.2026@portledge.org"},
  {name:"Ella Amatulli", gradeLevel:12, email:"eamatuli.2026@portledge.org"},
  {name:"Ethan Aymami", gradeLevel:12, email:"eaymami.2026@portledge.org"},
  {name:"Nate Bahnik", gradeLevel:12, email:"NBahnik.2026@portledge.org"},
  {name:"Jordana Binstock", gradeLevel:12, email:"jbinstock.2026@portledge.org"},
  {name:"Sammy Brodsky", gradeLevel:12, email:"sbrodsky.2026@portledge.org"},
  {name:"Carsyn Cammerer", gradeLevel:12, email:"ccammerer.2026@portledge.org"},
  {name:"Griffin Cavrell", gradeLevel:12, email:"GCavrell.2026@portledge.org"},
  {name:"Christopher Chen", gradeLevel:12, email:"cchen.2026@portledge.org"},
  {name:"Delila Cody", gradeLevel:12, email:"DCody.2026@portledge.org"},
  {name:"Ryan Coyne", gradeLevel:12, email:"rcoyne.2026@portledge.org"},
  {name:"Dom DeCola", gradeLevel:12, email:"ddecola.2026@portledge.org"},
  {name:"Charlie Dennehy", gradeLevel:12, email:"cdennehy.2026@portledge.org"},
  {name:"Ryan Desmond", gradeLevel:12, email:"RDesmond.2026@portledge.org"},
  {name:"Mackenzie DeVine", gradeLevel:12, email:"mcdevine.2026@portledge.org"},
  {name:"Max DeVine", gradeLevel:12, email:"mtdevine.2026@portledge.org"},
  {name:"Brendan Ding", gradeLevel:12, email:"yding.2026@portledge.org"},
  {name:"Lily Faltischek", gradeLevel:12, email:"LFaltischek.2026@portledge.org"},
  {name:"Jacob Friedberg", gradeLevel:12, email:"jfriedberg.2026@portledge.org"},
  {name:"Sarah Friedberg", gradeLevel:12, email:"sfriedberg.2026@portledge.org"},
  {name:"Skylar Friedman", gradeLevel:12, email:"SFriedman.2026@portledge.org"},
  {name:"Maddie Fuld", gradeLevel:12, email:"mfuld.2026@portledge.org"},
  {name:"Chloe Fuller", gradeLevel:12, email:"CFuller.2026@portledge.org"},
  {name:"Arsh Ghanchi", gradeLevel:12, email:"aghanchi.2026@portledge.org"},
  {name:"Matteo Giampetruzzi", gradeLevel:12, email:"mgiampetruzzi.2026@portledge.org"},
  {name:"Jack Gillies", gradeLevel:12, email:"jgillies.2026@portledge.org"},
  {name:"Autumn Glass", gradeLevel:12, email:"AGlass.2026@portledge.org"},
  {name:"Jonah Goldman", gradeLevel:12, email:"JGoldman.2026@portledge.org"},
  {name:"Dylón Gray-Cohen", gradeLevel:12, email:"DGray-Cohen.2026@portledge.org"},
  {name:"Nia Green", gradeLevel:12, email:"ngreen.2026@portledge.org"},
  {name:"Bo Wen He", gradeLevel:12, email:"bhe.2026@portledge.org"},
  {name:"Sabrina Hemley", gradeLevel:12, email:"SHemley.2026@portledge.org"},
  {name:"Zachary Ivezi", gradeLevel:12, email:"zivezi.2026@portledge.org"},
  {name:"Prajna Jain", gradeLevel:12, email:"PJain.2026@portledge.org"},
  {name:"Neela Jarmon", gradeLevel:12, email:"njarmon.2026@portledge.org"},
  {name:"Avery Joshua-Tor", gradeLevel:12, email:"AJoshua-Tor.2026@portledge.org"},
  {name:"Danny Kadirov", gradeLevel:12, email:"DKadirov.2026@portledge.org"},
  {name:"Catherine Kasper", gradeLevel:12, email:"CKasper.2026@portledge.org"},
  {name:"Goldie Kennedy", gradeLevel:12, email:"gkennedy.2026@portledge.org"},
  {name:"Kyle Lee", gradeLevel:12, email:"klee.2026@portledge.org"},
  {name:"Mason Lee", gradeLevel:12, email:"mlee.2026@portledge.org"},
  {name:"Lucas Leman Bertrand", gradeLevel:12, email:"llemanbertrand.2026@portledge.org"},
  {name:"Gavin Li", gradeLevel:12, email:"JLi.2026@portledge.org"},
  {name:"Gavin Ligotti", gradeLevel:12, email:"GLigotti.2026@portledge.org"},
  {name:"Jack Loeffler", gradeLevel:12, email:"jloeffler.2026@portledge.org"},
  {name:"Aria Mannering", gradeLevel:12, email:"amannering.2026@portledge.org"},
  {name:"Olga Markovic", gradeLevel:12, email:"OMarkovic.2026@portledge.org"},
  {name:"Caroline McKeon", gradeLevel:12, email:"cmckeon.2026@portledge.org"},
  {name:"Max Milano", gradeLevel:12, email:"MMilano.2026@portledge.org"},
  {name:"Tori Mormando", gradeLevel:12, email:"vmormando.2026@portledge.org"},
  {name:"Molly Murphy", gradeLevel:12, email:"mmurphy.2026@portledge.org"},
  {name:"Joseph Pata", gradeLevel:12, email:"JPata.2026@portledge.org"},
  {name:"Hope Peterson", gradeLevel:12, email:"hpeterson.2026@portledge.org"},
  {name:"Madalena Peterson", gradeLevel:12, email:"mpeterson.2026@portledge.org"},
  {name:"Damiano Petruccelli", gradeLevel:12, email:"dpetruccelli.2026@portledge.org"},
  {name:"Matteo Pietronigro", gradeLevel:12, email:"MPietronigro.2026@portledge.org"},
  {name:"Vihaan Pranav", gradeLevel:12, email:"vpranav.2026@portledge.org"},
  {name:"Rondell Rabsatt", gradeLevel:12, email:"rrabsatt.2026@portledge.org"},
  {name:"Zach Rahr", gradeLevel:12, email:"zrahr.2026@portledge.org"},
  {name:"Will Rigg", gradeLevel:12, email:"WRigg.2026@portledge.org"},
  {name:"Bobby Roth", gradeLevel:12, email:"rroth.2026@portledge.org"},
  {name:"Cole Sanveren", gradeLevel:12, email:"CSanveren.2026@portledge.org"},
  {name:"Shainil Shah", gradeLevel:12, email:"sshah.2026@portledge.org"},
  {name:"Rowan Shenoy", gradeLevel:12, email:"rshenoy.2026@portledge.org"},
  {name:"Avery Sklar", gradeLevel:12, email:"asklar.2026@portledge.org"},
  {name:"Cody Strauss", gradeLevel:12, email:"cstrauss.2026@portledge.org"},
  {name:"Kathy Sun", gradeLevel:12, email:"KSun.2026@portledge.org"},
  {name:"Bill Sun", gradeLevel:12, email:"qsun.2026@portledge.org"},
  {name:"Chelsea Tanguay", gradeLevel:12, email:"ctanguay.2026@portledge.org"},
  {name:"Peyton Tenenbaum", gradeLevel:12, email:"PTenenbaum.2026@portledge.org"},
  {name:"Tyler Wilson", gradeLevel:12, email:"TWilson.2026@portledge.org"},
  {name:"Vicky Yahoves", gradeLevel:12, email:"wyahoves.2026@portledge.org"},
  {name:"William Yarian", gradeLevel:12, email:"wyarian.2026@portledge.org"},
  {name:"Melody Zhang", gradeLevel:12, email:"yzhang.2026@portledge.org"},
  {name:"Niko Zografos", gradeLevel:12, email:"NZografos.2026@portledge.org"}
];

function initDirectory(inpSel, gridSel, infoSel, prevSel, nextSel, gradeSel){
  const inp=$(inpSel), grid=$(gridSel), info=$(infoSel), prev=$(prevSel), next=$(nextSel);
  const gradeEl = gradeSel ? $(gradeSel) : null;
  let kind='students', page=1, perPage=8;

  // Local buttons (resolve by container id prefix)
  const isTeacher = gridSel.startsWith('#t_');
  const tabTeach = isTeacher ? $('#t_btnTeach') : $('#btnTeach');
  const tabStud  = isTeacher ? $('#t_btnStud')  : $('#btnStud');

  function syncTabs(){ tabTeach.classList.toggle('active', kind==='teachers'); tabStud.classList.toggle('active', kind==='students'); }
  function render(){
    const q=(inp.value||'').toLowerCase().trim();
    const hasTeach = typeof teachers !== 'undefined' && Array.isArray(teachers);
    const hasStud = typeof studentsAll !== 'undefined' && Array.isArray(studentsAll);
    const src= kind==='teachers' ? (hasTeach?teachers:[]) : (hasStud?studentsAll:[]);
    if(kind==='students' && gradeEl){
      const g = (gradeEl.value||'').trim();
      if(!g){ grid.innerHTML=''; info.textContent='Select a grade to view students'; return; }
    }
    const list=src.filter(x=> (x.name+' '+(x.subject||'')+' '+(x.email||'')+(x.gradeLevel?' Grade '+x.gradeLevel:'')).toLowerCase().includes(q));
    const filtered = (kind==='students' && gradeEl && gradeEl.value)
      ? list.filter(x=> x.gradeLevel===Number(gradeEl.value))
      : list;
    const total=filtered.length, maxPage=Math.max(1,Math.ceil(total/perPage)); if(page>maxPage) page=maxPage;
    const slice=filtered.slice((page-1)*perPage,(page-1)*perPage+perPage);
    grid.innerHTML = slice.map(x=>`
      <div class="person">
        <div><div class="name">${x.name}</div><div class="meta">${kind==='teachers'?(x.subject||''):`Grade ${x.gradeLevel}`}</div></div>
        <div>${x.email?`<a class="mail" href="mailto:${x.email}">Email</a>`:''}</div>
      </div>`).join('');
    info.textContent = `Page ${page} of ${maxPage} • ${total} ${kind}`;
  }
  tabTeach.onclick=()=>{ kind='teachers'; page=1; syncTabs(); render(); };
  tabStud.onclick =()=>{ kind='students'; page=1; syncTabs(); render(); };
  inp.oninput = ()=>{ page=1; render(); };
  if(gradeEl) gradeEl.onchange = ()=>{ page=1; render(); };
  prev.onclick = ()=>{ page=Math.max(1,page-1); render(); };
  next.onclick = ()=>{ page=page+1; render(); };
  syncTabs(); render();
  // If data not yet loaded (due to script order), try a delayed re-render once
  setTimeout(()=>{ render(); }, 50);
}

/* ===== Simple modal reuse ===== */
function openModal(){ 
  const m=$('#gradeModal'); 
  m.classList.remove('hidden');
  // Focus the close button when modal opens
  const closeBtn = m.querySelector('#closeModal');
  if(closeBtn) setTimeout(() => closeBtn.focus(), 100);
}
$('#closeModal').onclick=()=>{ 
  const m=$('#gradeModal'); 
  m.classList.add('hidden');
};

</script>

<script>
  // ---- Small UX enhancements ----
  (function(){
    // Theme toggle with persistence
    const KEY = 'pd_theme_v11';
    const btn = document.getElementById('themeToggle');
    const saved = localStorage.getItem(KEY);
    if (saved === 'dark') {
      document.body.classList.add('theme-dark');
      if (btn) { btn.textContent = 'Light Mode'; btn.setAttribute('aria-pressed','true'); }
    }
    btn && btn.addEventListener('click', ()=>{
      const dark = document.body.classList.toggle('theme-dark');
      localStorage.setItem(KEY, dark ? 'dark' : 'light');
      btn.textContent = dark ? 'Light Mode' : 'Dark Mode';
      btn.setAttribute('aria-pressed', dark ? 'true' : 'false');
    });

    // Keyboard shortcuts for tabs (1..5)
    const TAB_KEYS = ['s-schedule','s-assign','s-grades','s-directory','s-pantherbot'];
    document.addEventListener('keydown', (e)=>{
      if (e.altKey || e.ctrlKey || e.metaKey) return;
      const tag = (e.target && e.target.tagName) || '';
      if (/INPUT|TEXTAREA|SELECT/.test(tag)) return;
      const idx = parseInt(e.key,10);
      if (!isNaN(idx) && idx>=1 && idx<=TAB_KEYS.length){
        const page = TAB_KEYS[idx-1];
        const tab = document.querySelector(`#nav-student .tab[data-page='${page}']`);
        tab && tab.click();
      }
    });

    // Update countdown every second
    const slots = document.getElementById('s_slots');
    if (slots){
      setInterval(updateCountdowns, 1000);
    }

    // PantherBot suggested chips
    document.querySelectorAll('.pb-suggestions .chip').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const q = btn.getAttribute('data-q') || btn.textContent;
        const input = document.getElementById('userInput');
        const send = document.getElementById('sendBtn');
        if (!input || !send) return;
        input.value = q;
        send.click();
      });
    });

    // Voice-to-text toggle
    let recognition = null;
    let listening = false;
    const voiceBtn = document.getElementById('voiceBtn');
    const userInput = document.getElementById('userInput');
    if (voiceBtn && userInput) {
      voiceBtn.addEventListener('click', () => {
        if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
          alert('Speech recognition not supported in this browser.');
          return;
        }
        if (!recognition) {
          const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
          recognition = new SpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
          };
          recognition.onend = function() {
            listening = false;
            voiceBtn.classList.remove('listening');
          };
        }
        if (!listening) {
          recognition.start();
          listening = true;
          voiceBtn.classList.add('listening');
        } else {
          recognition.stop();
          listening = false;
          voiceBtn.classList.remove('listening');
        }
      });
    }

    // Back to top button
    const btt = document.getElementById('backToTop');
    function syncBtt(){ btt && (btt.style.display = window.scrollY > 300 ? 'block' : 'none'); }
    window.addEventListener('scroll', syncBtt, {passive:true});
    btt && btt.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));
    syncBtt();
  })();
</script>

<script>
  // ---- FIXED TAB SWITCHING (Final) ----
  document.querySelectorAll("#nav-student .tab").forEach(tab => {
    tab.addEventListener("click", () => {
      const id = tab.dataset.page;
      document.querySelectorAll("#nav-student .tab").forEach(t => {
        t.classList.toggle("active", t === tab);
        t.setAttribute("aria-selected", t === tab);
      });
      document.querySelectorAll(".page").forEach(page => {
        const show = page.id === `page-${id}`;
        page.style.display = show ? "block" : "none";
        page.classList.toggle("active", show);
      });
    });
  });

  // Show Schedule by default when page loads
  window.addEventListener("DOMContentLoaded", () => {
    document.querySelector("#nav-student .tab[data-page='s-schedule']").click();
  });

  // Offline support removed per request
</script>

<script type="module" src="../pantherbot/pantherbot.js?v=20251023v51ultra"></script>

<script>
  // ===== Temp Settings Logic =====
  function openTempModal(){
    const m=document.getElementById('tempModal'); if(!m) return; 
    m.classList.remove('hidden');
    // Focus management: Focus the first input when modal opens
    const firstInput = m.querySelector('input, button');
    if(firstInput) setTimeout(() => firstInput.focus(), 100);
    // Prefill
    const o = localStorage.getItem('pd_time_override');
    const inp = document.getElementById('tempOverride');
    const status = document.getElementById('tempStatus');
    if (o && inp) {
      const dt = new Date(o);
      if (!isNaN(dt.getTime())) {
        // Convert to local datetime-local value (YYYY-MM-DDTHH:mm)
        const pad=n=>String(n).padStart(2,'0');
        const val = `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}T${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
        inp.value = val;
        status.textContent = `Override active: ${dt.toLocaleString()}`;
      }
    } else if (status) {
      status.textContent = 'No override active.';
    }
  }
  function closeTempModal(){ 
    const m=document.getElementById('tempModal'); 
    if(!m) return; 
    m.classList.add('hidden');
    // Return focus to trigger button if exists
    const triggerBtn = document.querySelector('[onclick*="openTempModal"]');
    if(triggerBtn) triggerBtn.focus();
  }
  function setTempNow(){
    const inp = document.getElementById('tempOverride');
    if(!inp) return;
    const now = new Date();
    const pad=n=>String(n).padStart(2,'0');
    const val = `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
    inp.value = val;
  }
  function applyTempOverride(){
    const inp = document.getElementById('tempOverride');
    const status = document.getElementById('tempStatus');
    if(!inp || !inp.value){ alert('Pick a date and time'); return; }
    const iso = new Date(inp.value).toISOString();
    localStorage.setItem('pd_time_override', iso);
    if (status) status.textContent = `Override active: ${new Date(iso).toLocaleString()}`;
    // Refresh schedule/progress immediately
    try { renderSchedule(); } catch {}
    try { updateCountdowns(); } catch {}
  }
  function clearTempOverride(){
    localStorage.removeItem('pd_time_override');
    const status = document.getElementById('tempStatus'); if (status) status.textContent = 'No override active.';
    try { renderSchedule(); } catch {}
    try { updateCountdowns(); } catch {}
  }
  
  // Wire header button
  window.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('tempSettingsBtn');
    if (btn && !btn.__bound){ btn.__bound = true; btn.addEventListener('click', openTempModal); }
  });
</script>

<!-- CUSTOMIZATION MODAL -->
<div id="customizeModal" class="modal" style="display:none">
  <div class="modal-content">
    <div class="modal-header">
      <h2>⚙️ Customize Your Experience</h2>
      <button class="modal-close" onclick="closeCustomizeModal()">×</button>
    </div>
    
    <div class="modal-body">
      <!-- Dashboard Colors -->
      <div class="customize-section">
        <h3>🎨 Dashboard Theme</h3>
        <div class="color-picker-group">
          <label>
            Accent Color:
            <input type="color" id="accentColor" value="#667eea" />
          </label>
          <label>
            Secondary Color:
            <input type="color" id="secondaryColor" value="#764ba2" />
          </label>
        </div>
      </div>
      
      <!-- Login Background -->
      <div class="customize-section">
        <h3>🌌 Login Background</h3>
        <select id="loginBg" class="custom-select">
          <option value="gradient1">Purple Gradient (Default)</option>
          <option value="gradient2">Ocean Blue</option>
          <option value="gradient3">Sunset Orange</option>
          <option value="gradient4">Forest Green</option>
          <option value="gradient5">Neon City</option>
        </select>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn-secondary" onclick="resetCustomizations()">Reset to Default</button>
      <button class="btn-primary" onclick="saveCustomizations()">Save Changes</button>
    </div>
  </div>
</div>

<button id="backToTop" aria-label="Back to top">↑ Top</button>

<!-- TEMP SETTINGS MODAL -->
<div id="tempModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2>⏱️ Temp Settings</h2>
      <button class="modal-close" onclick="closeTempModal()">×</button>
    </div>
    <div class="modal-body">
      <div class="customize-section">
        <h3>Override Current Time</h3>
        <p class="meta">Set a temporary date/time so the schedule behaves as if it's that moment.</p>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px">
          <input type="datetime-local" id="tempOverride" class="input" />
          <button class="btn" type="button" onclick="setTempNow()">Set Now</button>
          <button class="btn" type="button" onclick="applyTempOverride()">Apply</button>
          <button class="btn" type="button" onclick="clearTempOverride()">Clear</button>
        </div>
        <div class="meta" id="tempStatus" style="margin-top:6px;">No override active.</div>
      </div>
    </div>
  </div>
  
</div>
</body>
</html>

